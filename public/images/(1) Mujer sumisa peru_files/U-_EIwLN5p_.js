if (self.CavalryLogger) { CavalryLogger.start_js(["a9mCv"]); }

__d("PagesMessagingConst",[],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={LOAD_MESSAGE_THREAD_URI:"\/ajax\/pages\/messages\/load_message_thread.php",UNANSWERED_FILTER:"unanswered"};}),null);
__d("AdsTargetingTogglerSafeMixin",[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={setStateSafe:function i(j,k){setTimeout(function(){this.setState(j,k);}.bind(this),0);}};f.exports=h;}),null);
__d('PagesManagerMessagesInterface',['ge','Animation','Arbiter','AsyncRequest','MercuryThreadActions','XMessagingSetPreferencesController'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h='PagesManagerMessagesInterface',i={applyIfVisibleOnPage:function j(k,l){var m=c('ge')(k);if(m)l(m);},changeThreadSpamStatus:function j(k,l,m){if(m){c('MercuryThreadActions').getForFBID(k).markSpam(l,'PagesManagerInterface');}else c('MercuryThreadActions').getForFBID(k).unmarkSpam(l,'PagesManagerInterface');},changeThreadArchivedStatus:function j(k,l,m,n){if(m){c('MercuryThreadActions').getForFBID(k).archive(l,h);}else c('MercuryThreadActions').getForFBID(k).unarchive(l,h);},changeThreadReadStatus:function j(k,l,m,n){if(m){c('MercuryThreadActions').getForFBID(k).markRead(l,h);}else c('MercuryThreadActions').getForFBID(k).markUnread(l,h);},hideElement:function j(k){new (c('Animation'))(k).to('opacity',0).duration(150).hide().go();},notifyUpdateCompleted:function j(){c('Arbiter').inform('PagesManagerLayout/refreshSection',{section:'messages'});},updateUnreadCount:function j(k){c('Arbiter').inform('pagesManagerMessaging/messageUnreadCountUpdated',{metricCount:k});c('Arbiter').inform('PagesManagerLayout/updateCount',{count:k,section:'messages'});c('Arbiter').inform('PagesManagerLayout/updateCount',{count:k,section:'messages',subsection:'inbox'});},updatePreferences:function j(k){var l=c('XMessagingSetPreferencesController').getURIBuilder().setBool('send_on_enter',k.sendOnEnter).getURI();new (c('AsyncRequest'))(l).send();}};f.exports=i;}),null);
__d('PagesMessengerButtonSet.react',['cx','fbt','Arbiter','AsyncRequest','MercuryThreads','MessagingTag','PagesManagerMessagesInterface','PagesMessagingActionPlacement','PopoverMenu.react','XUIPopoverButton.react','React','ReactXUIMenu','XUIDialog.react','XUIDialogBody.react','XUIDialogButton.react','XUIDialogCancelButton.react','XUIDialogFooter.react','XUIDialogTitle.react','XNFXStartForMessageThreadController'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes,m=c('ReactXUIMenu').Item;j=babelHelpers.inherits(n,c('React').Component);k=j&&j.prototype;function n(o){'use strict';k.constructor.call(this,o);this.$PagesMessengerButtonSet2=function(p,q){if(!q.item.isDisabled()){var r=q.item.getValue(),s=true;if('mark_as_unread'===r){this.$PagesMessengerButtonSet3();}else if('archive_thread_toggle'===r){this.$PagesMessengerButtonSet4();}else if('report_message'===r){this.$PagesMessengerButtonSet5();}else if('spam_thread_toggle'===r){this.$PagesMessengerButtonSet6();}else if('delete'===r){this.props.onDeleteMessageAction(false);s=false;}else if('delete_thread'===r){this.setState({showDeleteAllMessagesDialog:true});s=false;}if(s)c('Arbiter').inform('PagesMessengerThread/hideMessageThread');}}.bind(this);this.$PagesMessengerButtonSet3=function(){c('PagesManagerMessagesInterface').changeThreadReadStatus(this.props.user,this.props.threadElementID,false,c('PagesMessagingActionPlacement').MESSAGE_DIALOG_ACTION_LIST);}.bind(this);this.$PagesMessengerButtonSet4=function(){c('PagesManagerMessagesInterface').changeThreadArchivedStatus(this.props.user,this.props.threadElementID,!this.isArchived(),c('PagesMessagingActionPlacement').MESSAGE_DIALOG_ACTION_LIST);}.bind(this);this.$PagesMessengerButtonSet5=function(){var p=c('XNFXStartForMessageThreadController').getURIBuilder().setString('thread_fbid',this.props.threadElementID).setInt('av',this.props.user).getURI();new (c('AsyncRequest'))().setURI(p).send();}.bind(this);this.$PagesMessengerButtonSet6=function(){c('PagesManagerMessagesInterface').changeThreadSpamStatus(this.props.user,this.props.threadElementID,!this.isSpam());}.bind(this);this.renderAuxButtonSet=function(){var p=this.isArchived()?i._("Desarchivar"):i._("Archivo"),q=c('React').createElement(m,{key:'archive_thread_toggle',value:'archive_thread_toggle'},p),r=this.isSpam()?i._("No es spam"):i._("Marcar como spam"),s=c('React').createElement(m,{key:'spam_thread_toggle',value:'spam_thread_toggle'},r),t=[];if(!this.isSpam())t.push(q);if(this.props.allowReport)t.push(c('React').createElement(m,{key:'report_message',value:'report_message'},i._("Reportar")));if(!this.isArchived())t.push(s);var u=c('React').createElement(c('ReactXUIMenu'),{onItemClick:this.$PagesMessengerButtonSet2},c('React').createElement(m,{value:'mark_as_unread'},i._(["Marcar como no le\u00eddo","d40d50f73da3233202117a2dc422f97d"])),t,c('React').createElement(m,{value:'delete',disabled:this.props.isDeleteButtonDisabled},i._("Eliminar selecci\u00f3n")),c('React').createElement(m,{value:'delete_thread'},i._("Eliminar todos")));return u;}.bind(this);this.isSpam=function(){return this.state.currentFolder===c('MessagingTag').SPAM;}.bind(this);this.isArchived=function(){return this.state.currentFolder===c('MessagingTag').ARCHIVED;}.bind(this);this.renderDeleteAllMessagesConfirmationDialog=function(){return (c('React').createElement(c('XUIDialog.react'),{width:360,shown:this.state.showDeleteAllMessagesDialog,onToggle:this.$PagesMessengerButtonSet7},c('React').createElement(c('XUIDialogTitle.react'),null,i._("\u00bfEliminar todos los mensajes?")),c('React').createElement('div',{className:"_4asv"},c('React').createElement(c('XUIDialogBody.react'),null,i._("\u00bfSeguro que quieres eliminar todos los mensajes?")),c('React').createElement(c('XUIDialogFooter.react'),null,c('React').createElement(c('XUIDialogCancelButton.react'),{onClick:this.$PagesMessengerButtonSet8}),c('React').createElement(c('XUIDialogButton.react'),{use:'confirm',label:i._("Eliminar mensajes"),onClick:this.$PagesMessengerButtonSet9})))));}.bind(this);this.$PagesMessengerButtonSet9=function(){this.setState({showDeleteAllMessagesDialog:false});this.props.onDeleteMessageAction(true);c('Arbiter').inform('PagesMessengerThread/hideMessageThread');}.bind(this);this.$PagesMessengerButtonSet8=function(){this.setState({showDeleteAllMessagesDialog:false});}.bind(this);this.$PagesMessengerButtonSet7=function(p){if(!p)this.$PagesMessengerButtonSet8();}.bind(this);this.$PagesMessengerButtonSet1=c('MercuryThreads').getForFBID(o.user);this.state={currentFolder:o.folder,showDeleteAllMessagesDialog:false};}n.prototype.render=function(){'use strict';return c('React').createElement('div',null,c('React').createElement(c('PopoverMenu.react'),{alignh:'right',menu:this.renderAuxButtonSet()},c('React').createElement(c('XUIPopoverButton.react'),{label:i._("Acciones")})),this.renderDeleteAllMessagesConfirmationDialog());};n.propTypes={isDeleteButtonDisabled:l.bool.isRequired,user:l.string.isRequired,threadID:l.string.isRequired,threadElementID:l.string.isRequired,folder:l.string.isRequired,onDeleteMessageAction:l.func.isRequired,allowReport:l.bool.isRequired};f.exports=n;}),null);
__d('PagesMessengerInfoButton.react',['cx','fbt','Link.react','PopoverMenu.react','React','ReactMenu','XUIMenuSeparator.react'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('ReactMenu').Item,m='/help/contact/1024405850920269',n='/help/988319821208361';j=babelHelpers.inherits(o,c('React').Component);k=j&&j.prototype;o.prototype.render=function(){'use strict';var p=c('React').createElement(c('ReactMenu'),null,c('React').createElement(l,{href:n,target:'_blank'},i._("Ir al servicio de ayuda")),c('React').createElement(c('XUIMenuSeparator.react'),null),c('React').createElement(l,{href:m,target:'_blank'},i._("Enviar comentarios")));return (c('React').createElement(c('PopoverMenu.react'),{className:"_jrs",menu:p},c('React').createElement(c('Link.react'),{className:"_jrt"})));};function o(){'use strict';j.apply(this,arguments);}f.exports=o;}),null);
__d('PagesMessengerPageAdminNoteButton.react',['cx','fbt','Link.react','React'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;m.prototype.render=function(){var n=i._("Create an admin note");return (c('React').createElement(c('Link.react'),{'aria-label':n,className:"_lxz",'data-hover':'tooltip','data-tooltip-alignh':'center','data-tooltip-content':n,onClick:this.props.onClick}));};function m(){j.apply(this,arguments);}m.propTypes={onClick:l.func};f.exports=m;}),null);
__d('PagesMessengerComposer.react',['cx','fbt','ChatPhotoUploader.react','DragDropTarget','EmoticonsList','EmoticonUtils','ImageBlock.react','MercuryPageMessageActions','MercuryConfig','MercuryDragDropPrompt.react','MercuryParticipants','React','ReactDOM','Run','PagesManagerMessagesInterface','PagesMessengerInfoButton.react','PagesMessageSuggestedResponseHandler','PagesMessengerSuggestedResponseView.react','PagesMessengerFileUploader.react','PagesMessengerShareLinkUploader','PagesMessengerTextInput.react','Image.react','MercuryIDs','MercuryMessageIDs','MercuryMessageObject','MercuryMessages','MercurySourceType','URI','XUICheckboxInput.react','XUIButton.react','PagesMessagingConfig','PagesEventObserver','PagesEventType','PagesMessengerPageAdminNoteButton.react','SelectionPosition','SavedResponsesUtils','UFIStickerButton.react','joinClasses'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(n){'use strict';k.constructor.call(this,n);this.hasInput=function(){return !!this.state.value;}.bind(this);this.clearInput=function(){this.setState({value:''});}.bind(this);this.focusInput=function(){if(this.refs.textInput)c('ReactDOM').findDOMNode(this.refs.textInput).focus();}.bind(this);this.$PagesMessengerComposer4=function(){if(this.props.focusOnUpdate)this.focusInput();}.bind(this);this.setUpShareLinkUploader=function(){if(this.refs.linkPreview&&this.refs.textInput)this.setState({shareLinkUploader:new (c('PagesMessengerShareLinkUploader'))(c('ReactDOM').findDOMNode(this.refs.linkPreview),this.refs.textInput.refs.input,function(){return this.$PagesMessengerComposer5;}.bind(this),function(){return this.$PagesMessengerComposer6;}.bind(this),this.props.user)});}.bind(this);this.processConfirm=function(o){if(this.state.isPageAdminNoteMode){this.processCreateNote(o);}else this.processSend(o);}.bind(this);this.processCreateNote=function(o){if(this.hasEnteredText()){var p={creatorID:this.props.creatorInfo.creatorID,creatorType:this.props.creatorInfo.creatorType,creatorName:this.props.creatorInfo.creatorName,labelType:'page_admin_note',pageID:this.props.creatorInfo.pageID,profileURI:this.props.creatorInfo.profileURI},q={id:null,body:this.state.value,creator_info:p,timestamp:Math.floor(Date.now()/1000)};this.$PagesMessengerComposer3.getThreadMessagesRange(this.props.threadID,0,1,function(r){if(!r.length)return;var s=r[0];if(this.$PagesMessengerComposer3.isLocalMessage(s)){c('MercuryMessageIDs').getServerIDs([s.message_id],function(t){if(t.length){var u=t[0];this.$PagesMessengerComposer2.createNote(q,this.props.threadID,u);}}.bind(this));}else this.$PagesMessengerComposer2.createNote(q,this.props.threadID,s.message_id);}.bind(this));o.preventDefault();this.clearInput();this.setState({isPageAdminNoteMode:!this.state.isPageAdminNoteMode});}}.bind(this);this.processSend=function(o){var p=this.refs.textInput.refs.input.value,q=[],r=[],s=[],t=[],u=[],v=[];q=this.$PagesMessengerComposer8.getAttachments();r=this.$PagesMessengerComposer8.getImageFiles();s=this.$PagesMessengerComposer8.getAnimatedImageFiles();t=this.$PagesMessengerComposer8.getVideoFiles();u=this.$PagesMessengerComposer8.getAudioFiles();v=this.$PagesMessengerComposer8.getFiles();var w=this.state.shareLinkUploader.getAttachData();if(this.$PagesMessengerComposer9()){this.$PagesMessengerComposer10();o.preventDefault();return;}if(!p&&!q.length&&!r.length&&!t.length&&!v.length&&!w)return;var x=this.$PagesMessengerComposer1.constructUserGeneratedMessageObject(p,c('MercurySourceType').TITAN_WEB,this.props.threadID,null,this.props.creatorInfo);if(w){x.has_attachment=true;x.content_attachment=w;}if(q.length>0){x.has_attachment=true;x.raw_attachments=q;}if(r.length>0){x.image_ids=r;x.has_attachment=true;}if(s.length>0){x.gif_ids=s;x.has_attachment=true;}if(t.length>0){x.video_ids=t;x.has_attachment=true;}if(u.length>0){x.audio_ids=u;x.has_attachment=true;}if(v.length>0){x.file_ids=v;x.has_attachment;}c('PagesEventObserver').logData_DEPRECATED({page_id:this.props.user,event_name:c('PagesEventType').MESSAGES_DIALOG_SEND,thread_id:this.props.threadElementID},null);var y=this.props.suggestedResponseHandler;if(y&&y.shouldBeTreatedAsRejected())y.sendFeedback(false);this.props.onBeforeSend();this.$PagesMessengerComposer2.send(x);this.$PagesMessengerComposer8.removeAttachments();this.state.shareLinkUploader.clear();o.preventDefault();this.setState({value:''});}.bind(this);this.onChange=function(o){this.setState({value:o.target.value});}.bind(this);this.$PagesMessengerComposer9=function(){return this.$PagesMessengerComposer8.isUploading();}.bind(this);this.$PagesMessengerComposer10=function(){this.props.displayErrorMessage(true);}.bind(this);this.$PagesMessengerComposer5=function(){if(this.$PagesMessengerComposer11)if(this.$PagesMessengerComposer9())return;this.$PagesMessengerComposer11=false;this.props.displayErrorMessage(false);}.bind(this);this.setSavedResponse=function(o,p){if(this.$PagesMessengerComposer8)this.$PagesMessengerComposer8.removeAttachments();if(p)this.$PagesMessengerComposer8.addCachedAttachments([c('SavedResponsesUtils').generateImageMetadata(p)]);this.setState({value:o},this.refs.textInput.resetHeight);}.bind(this);this.setPlaceholderText=function(o){this.setState({temporaryPlaceholder:o},this.refs.textInput.resetHeight);}.bind(this);this.$PagesMessengerComposer6=function(){c('ReactDOM').findDOMNode(this.refs.textInput).focus();}.bind(this);this.setFileUploader=function(o){this.$PagesMessengerComposer8=o;}.bind(this);this.$PagesMessengerComposer19=function(event){var o=event.target.checked;this.setState({isQuickReplyMode:o});c('PagesMessagingConfig').sendOnEnter=o;c('PagesManagerMessagesInterface').updatePreferences({sendOnEnter:o});}.bind(this);this.$PagesMessengerComposer15=function(o,p){var q=this.$PagesMessengerComposer1.constructUserGeneratedMessageObject('',c('MercurySourceType').TITAN_WEB,this.props.threadID,null,this.props.creatorInfo);this.props.onBeforeSend();this.$PagesMessengerComposer2.addAttachmentPlaceholder(q,p.upload_id,p);}.bind(this);this.$PagesMessengerComposer12=function(o,event){var p=this.$PagesMessengerComposer1.constructUserGeneratedMessageObject('',c('MercurySourceType').TITAN_WEB,this.props.threadID,null,this.props.creatorInfo);p.has_attachment=true;p.sticker_id=o;this.props.onBeforeSend();this.$PagesMessengerComposer2.send(p);}.bind(this);this.$PagesMessengerComposer13=function(o){var p=c('EmoticonsList').symbols[o];if(!p)return;var q=this.refs.textInput.refs.input;this.$PagesMessengerComposer20=this.$PagesMessengerComposer20||new (c('SelectionPosition'))(q);var r=this.state.value||'',s=c('EmoticonUtils').insertEmoticon(p,r,this.$PagesMessengerComposer20.getPos());this.$PagesMessengerComposer20.setPos(s.start,s.end);this.setState({value:s.result});}.bind(this);this.$PagesMessengerComposer16=function(o,p){this.props.onBeforeSend();this.$PagesMessengerComposer2.confirmAttachmentPlaceholder(p.upload_id,p);}.bind(this);this.$PagesMessengerComposer17=function(o,p){this.$PagesMessengerComposer2.cancelAttachmentPlaceholder(p.upload_id,p);}.bind(this);this.$PagesMessengerComposer14=function(){return new (c('URI'))(c('MercuryConfig').upload_url).addQueryData('request_user_id',this.props.user).toString();}.bind(this);this.$PagesMessengerComposer18=function(){this.clearInput();this.setState({isPageAdminNoteMode:!this.state.isPageAdminNoteMode});}.bind(this);this.getConfirmButtonLabel=function(){if(this.state.isPageAdminNoteMode){return i._("Nota");}else return i._("Responder");}.bind(this);this.getDefaultPlaceholder=function(){if(this.state.isPageAdminNoteMode){return i._("Agrega una nota del administrador...");}else return i._("Escribe una respuesta...");}.bind(this);this.getSendOnEnterText=function(){if(this.state.isPageAdminNoteMode){return i._("Presiona \"Enter\" para crear una nota");}else return i._("Presiona \"Enter\" para enviar");}.bind(this);this.$PagesMessengerComposer1=c('MercuryMessageObject').getForFBID(n.user);this.$PagesMessengerComposer2=c('MercuryPageMessageActions').getForFBID(n.user);this.$PagesMessengerComposer3=c('MercuryMessages').getForFBID(n.user);this.state={currentParticipant:null,isQuickReplyMode:c('PagesMessagingConfig').sendOnEnter,isPageAdminNoteMode:false,shareLinkUploader:null,temporaryPlaceholder:null};}m.prototype.componentWillMount=function(){'use strict';var n=c('MercuryIDs').getParticipantIDFromUserID(this.props.user);c('MercuryParticipants').get(n,function(o){this.setState({currentParticipant:o});}.bind(this));};m.prototype.componentDidMount=function(){'use strict';this.setUpShareLinkUploader();if(c('PagesMessagingConfig').dragdropEnabled)new (c('DragDropTarget'))(c('ReactDOM').findDOMNode(this)).setOnFilesDropCallback(function(n){var o=this.refs.fileUploader;if(o)o.addFiles(n);}.bind(this)).setOnURLDropCallback(function(n){var o=this.state.shareLinkUploader;if(o)o.loadShare(n);}.bind(this)).enable();this.$PagesMessengerComposer4();this.$PagesMessengerComposer7=c('Run').onBeforeUnload(function(){return this.hasInput()?i._("Todav\u00eda no enviaste tu mensaje. \u00bfQuieres salir sin enviarlo?"):null;}.bind(this));};m.prototype.componentDidUpdate=function(){'use strict';if(!this.state.shareLinkUploader)this.setUpShareLinkUploader();this.$PagesMessengerComposer4();};m.prototype.componentWillUnmount=function(){'use strict';this.$PagesMessengerComposer7&&this.$PagesMessengerComposer7.remove();this.state.shareLinkUploader&&this.state.shareLinkUploader.destroy();};m.prototype.render=function(){'use strict';if(!this.state.currentParticipant)return c('React').createElement('div',null);var n=this.state.temporaryPlaceholder?this.state.temporaryPlaceholder:this.getDefaultPlaceholder(),o=this.props.isSavedResponsesBrowsePanelOn?i._("Ocultar respuestas guardadas"):i._("Mostrar respuestas guardadas");return c('React').createElement('div',babelHelpers['extends']({},this.props,{className:c('joinClasses')(this.props.className,"_5id0 _1ia")}),c('React').createElement(c('MercuryDragDropPrompt.react'),null),c('React').createElement(c('ImageBlock.react'),null,c('React').createElement('a',{className:"_5icz"},c('React').createElement(c('Image.react'),{src:this.state.currentParticipant.image_src,className:"_5ic-"})),c('React').createElement('div',{className:"_5tbe"},c('React').createElement(c('PagesMessengerTextInput.react'),{className:"_5id1",onNoShiftEnter:this.state.isQuickReplyMode?this.processConfirm:null,placeholder:n,onChange:this.onChange,onKeyUp:this.props.onKeyUp,value:this.state.value,ref:'textInput'}),c('React').createElement(c('PagesMessengerSuggestedResponseView.react'),{suggestedResponseHandler:this.props.suggestedResponseHandler,onAccepted:function(p){this.setState({value:p});}.bind(this)}),c('React').createElement('div',{className:"_oan",ref:'linkPreview'}))),c('React').createElement('div',{className:"_2w65"},c('React').createElement('div',{className:"_2w66"},this.props.isSavedResponseEnabled?c('React').createElement(c('XUIButton.react'),{onClick:this.props.onSavedResponsesButtonClicked,label:o}):null,c('React').createElement(c('XUIButton.react'),{use:'confirm',onClick:this.processConfirm,label:this.getConfirmButtonLabel()})),c('React').createElement('div',{className:"_5tbf"},c('PagesMessagingConfig').feedbackFormEnabled?c('React').createElement(c('PagesMessengerInfoButton.react'),null):null,c('PagesMessagingConfig').stickersEnabled?c('React').createElement(c('UFIStickerButton.react'),{onStickerSelected:this.$PagesMessengerComposer12,onEmoticonSelected:this.$PagesMessengerComposer13}):null,c('React').createElement(c('ChatPhotoUploader.react'),{customUI:true,imageClassName:"hidden_elem",linkClassName:"_6gb _6ge",className:"_6gd _1_18",actionURI:this.$PagesMessengerComposer14(),onSubmit:this.$PagesMessengerComposer15,onAllUploadsComplete:this.$PagesMessengerComposer16,onLastUploadFail:this.$PagesMessengerComposer17}),this.props.attachmentsShelf?c('React').createElement(c('PagesMessengerFileUploader.react'),{actionURI:this.$PagesMessengerComposer14(),attachmentsShelf:c('ReactDOM').findDOMNode(this.props.attachmentsShelf),onUploadFinished:this.$PagesMessengerComposer5,onFileUploaderMounted:this.setFileUploader,onSubmit:function(){return this.$PagesMessengerComposer6;}.bind(this),ref:'fileUploader'}):null,this.props.isPageAdminNoteEnabled?c('React').createElement(c('PagesMessengerPageAdminNoteButton.react'),{onClick:this.$PagesMessengerComposer18}):null,c('React').createElement('div',{className:"_29hw"},c('React').createElement(c('XUICheckboxInput.react'),{className:"_2w68",checked:this.state.isQuickReplyMode,onChange:this.$PagesMessengerComposer19}),c('React').createElement('div',{className:"_2w67"},this.getSendOnEnterText())))));};m.propTypes={user:l.string.isRequired,threadID:l.string.isRequired,threadElementID:l.string.isRequired,onBeforeSend:l.func.isRequired,onKeyUp:l.func,otherUserID:l.string,creatorInfo:l.object,attachmentsShelf:l.object,displayErrorMessage:l.func.isRequired,suggestedResponseHandler:l.instanceOf(c('PagesMessageSuggestedResponseHandler')),isSuggestedResponseEnabled:l.bool.isRequired,isSavedResponseEnabled:l.bool.isRequired,isPageAdminNoteEnabled:l.bool.isRequired,isSavedResponsesBrowsePanelOn:l.bool,onSavedResponsesButtonClicked:l.func.isRequired,focusOnUpdate:l.bool};m.defaultProps={initialValue:"",isSavedResponsesBrowsePanelOn:false,focusOnUpdate:true};f.exports=m;}),null);
__d('PagesMessengerMessage.react',['cx','HovercardLink','Image.react','ImageBlock.react','ImmutableObject','Layout.react','LeftRight.react','MercuryLogMessage.react','MercuryActionType','MercuryAttachment','MercuryAttachments.react','MercuryIDs','MercuryMessageBody.react','MercuryMessageError.react','MercuryParticipants','PagesMessengerCreatorInfo.react','React','TooltipLink.react','XUICheckboxInput.react','XUIGrayText.react','formatDate'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=c('Layout.react').Column,m=c('Layout.react').FillColumn,n=406,o=94,p=200;i=babelHelpers.inherits(q,c('React').Component);j=i&&i.prototype;function q(){var r,s;for(var t=arguments.length,u=Array(t),v=0;v<t;v++)u[v]=arguments[v];return s=(r=j.constructor).call.apply(r,[this].concat(u)),this.state={participant:{}},this.isLogMessage=function(){return this.props.message.action_type===c('MercuryActionType').LOG_MESSAGE;}.bind(this),this.renderParticipantName=function(){var w=c('MercuryIDs').getUserIDFromParticipantID(this.state.participant.id),x=c('HovercardLink').constructEndpoint({id:w}).toString(),y=null;if(this.state.participant.href){y=c('React').createElement('a',{href:this.state.participant.href,'data-hovercard':x},this.state.participant.name);}else y=this.state.participant.name;var z=new Date(this.props.message.timestamp);return (c('React').createElement(c('LeftRight.react'),null,c('React').createElement('div',null,c('React').createElement('div',{className:"_5hpc"},y),this.renderCreatorInfo()),this.renderMessageDate(z)));}.bind(this),this.renderMessageDate=function(w){var x=new Date();if(x.getFullYear()===w.getFullYear()){return (c('React').createElement(c('TooltipLink.react'),{className:"_5icy",tooltip:c('React').createElement('span',null,c('formatDate')(w,'M d, Y g:ia'))},c('formatDate')(w,'M jS, g:ia')));}else return (c('React').createElement(c('XUIGrayText.react'),{shade:'light',size:'small',className:"_5icy"},c('formatDate')(w,'M d, Y g:ia')));},this.renderParticipantImage=function(){if(this.isLogMessage())return (c('React').createElement('div',{className:"_5icz"},c('React').createElement('div',{className:"_17y6"})));if(this.state.participant.href)return (c('React').createElement('a',{className:"_5icz",href:this.state.participant.href},c('React').createElement(c('Image.react'),{src:this.state.participant.image_src,className:"_5ic-"})));return (c('React').createElement('div',{className:"_5icz"},c('React').createElement(c('Image.react'),{src:this.state.participant.image_src,className:"_5ic-"})));}.bind(this),this.renderMessage=function(){if(this.isLogMessage())return c('React').createElement('div',null);var w=c('MercuryAttachment').get(this.props.message),x=null,y=this.props.customDialogWidth?this.props.customDialogWidth-o:n;if(w.length>0)x=c('React').createElement(c('MercuryAttachments.react'),{className:"_ksr",maxWidth:y,message:new (c('ImmutableObject'))(this.props.message),attachments:w});return (c('React').createElement('div',null,c('React').createElement(c('MercuryMessageBody.react'),{className:"_3qi9",body:this.props.message.body}),x,c('React').createElement(c('MercuryMessageError.react'),{message:new (c('ImmutableObject'))(this.props.message),authorFBID:this.props.user})));}.bind(this),this.renderCreatorInfo=function(){if(this.props.message.creator_info)return (c('React').createElement(c('PagesMessengerCreatorInfo.react'),{creator_info:this.props.message.creator_info}));}.bind(this),this.renderLogMessage=function(){var w=new Date(this.props.message.timestamp);return (c('React').createElement(c('LeftRight.react'),{className:"_17y7"},c('React').createElement(c('MercuryLogMessage.react'),{maxWidth:Math.floor(this.props.customDialogWidth-p),message:new (c('ImmutableObject'))(this.props.message)}),this.renderMessageDate(w)));}.bind(this),s;}q.prototype.componentWillMount=function(){c('MercuryParticipants').get(this.props.message.author,function(r){this.setState({participant:r});}.bind(this));};q.prototype.render=function(){if(!this.state.participant.id)return c('React').createElement('div',null);return (c('React').createElement('div',{className:"_5hpb"},c('React').createElement(c('Layout.react'),null,c('React').createElement(l,null,c('React').createElement(c('XUICheckboxInput.react'),{className:"_1mtg"+(this.isLogMessage()?' '+"invisible_elem":''),onChange:this.props.messageCheckStatusChangedHandler,value:this.props.message.message_id})),c('React').createElement(m,null,c('React').createElement(c('ImageBlock.react'),null,this.renderParticipantImage(),c('React').createElement('div',null,this.isLogMessage()?this.renderLogMessage():this.renderParticipantName(),this.renderMessage()))))));};q.propTypes={customDialogWidth:k.number.isRequired,messageCheckStatusChangedHandler:k.func.isRequired,user:k.string.isRequired,message:k.object.isRequired};q.defaultProps={customDialogWidth:500};f.exports=q;}),null);
__d('MessengerPresenceStatus.react',['fbt','React'],(function a(b,c,d,e,f,g,h){'use strict';var i,j;if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes;i=babelHelpers.inherits(l,c('React').PureComponent);j=i&&i.prototype;l.prototype.render=function(){var m=void 0;if(this.props.isUserActive){m=h._("Activo(a) en {platform}",[h.param('platform',this.props.platform)]);}else if(this.props.lastActive){m=h._("Activo(a) hace {time}",[h.param('time',this.props.lastActive)]);}else m=this.props.platform;return (c('React').createElement('span',{className:this.props.className},m));};function l(){i.apply(this,arguments);}l.propTypes={isUserActive:k.bool.isRequired,lastActive:k.string,platform:k.string};f.exports=l;}),null);
__d('MessengerPresenceStatusUtils',['fbt','AvailableListConstants','LastActiveTimes','MercuryIDs','PresenceStatus'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i={getStatusFromCanonicalThread:function j(k,l){var m=null;if(l&&l.is_canonical){var n=k.get(c('MercuryIDs').getParticipantIDFromFromThreadID(l.thread_id));if(n){var o=c('PresenceStatus').get(n.fbid),p=void 0,q=void 0,r=n.is_messenger_user?h._("Messenger"):h._("Facebook");if(o!==c('AvailableListConstants').ACTIVE){p=c('LastActiveTimes').get(n.fbid);q=c('LastActiveTimes').getShortDisplay(n.fbid);}m={contact:n,platform:r,isUserActive:o===c('AvailableListConstants').ACTIVE,lastActiveTS:p,lastActive:q};}}return m;}};f.exports=i;}),null);
__d('SavedResponsesBrowseListView.react',['cx','fbt','Link.react','PagesEventObserver','PagesEventType','React','SavedResponsesConstants','SavedResponsesFooterButton.react','SavedResponsesListView.react','SavedResponsesListViewContainer.react','SavedResponsesUtils','ScrollableArea.react'],(function a(b,c,d,e,f,g,h,i){var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(n,o){'use strict';k.constructor.call(this,n,o);this.state={isDataReady:false,isFetching:false,responses:[],searchQuery:"",tokens:null};}m.prototype.componentDidMount=function(){'use strict';this.refreshSavedResponsesList();};m.prototype.render=function(){'use strict';return (c('React').createElement(c('SavedResponsesListViewContainer.react'),{footerPart:this.$SavedResponsesBrowseListView1(),onSearchQueryChanged:function(n){return this.$SavedResponsesBrowseListView2(n);}.bind(this),onSearchQueryCleared:function(){return this.$SavedResponsesBrowseListView3();}.bind(this),searchQuery:this.state.searchQuery},this.$SavedResponsesBrowseListView4()));};m.prototype.refreshSavedResponsesList=function(){'use strict';if(this.state.isFetching)return;this.setState({isFetching:true});c('SavedResponsesUtils').fetchSavedResponses(this.props.pageID,this.props.otherUserID,function(n,o){return (this.setState({isDataReady:true,isFetching:false,responses:n,tokens:o}));}.bind(this));};m.prototype.$SavedResponsesBrowseListView4=function(){'use strict';return (c('React').createElement('div',{className:"_4pno"},c('React').createElement(c('ScrollableArea.react'),{fade:true,shadow:true},c('React').createElement(c('SavedResponsesListView.react'),{isLoadingResponses:!this.state.isDataReady,onResponseHover:this.props.onResponseHover,onResponseSelected:this.props.onResponseSelected,onResponseUnhover:this.props.onResponseUnhover,pageID:this.props.pageID,responses:this.state.responses,searchQuery:this.state.searchQuery,supportedMacros:this.state.tokens,sortingKey:c('SavedResponsesConstants').sortingKey.MOST_USED}),this.$SavedResponsesBrowseListView5())));};m.prototype.$SavedResponsesBrowseListView1=function(){'use strict';var n=i._("Administrar respuestas");return (c('React').createElement('div',{className:"_4pnp"},c('React').createElement(c('SavedResponsesFooterButton.react'),{label:n,onClick:function(){return this.$SavedResponsesBrowseListView6();}.bind(this)})));};m.prototype.$SavedResponsesBrowseListView5=function(){'use strict';return (c('React').createElement('div',{className:"_4pnq"},c('React').createElement('div',{className:"_50f8"+(' '+"_4pnr")},i._("Fin de las respuestas guardadas")),c('React').createElement(c('Link.react'),{onClick:function(){return this.$SavedResponsesBrowseListView7();}.bind(this),className:"_4pnr"+(' '+"_4pns")+(' '+"_50f8")},i._("Crear respuesta nueva"))));};m.prototype.$SavedResponsesBrowseListView2=function(n){'use strict';this.setState({searchQuery:n.target.value});};m.prototype.$SavedResponsesBrowseListView3=function(){'use strict';this.setState({searchQuery:""});};m.prototype.$SavedResponsesBrowseListView6=function(){'use strict';c('PagesEventObserver').logData_DEPRECATED({event_name:c('PagesEventType').SAVED_REPLIES_MANAGE_REPLIES,page_id:this.props.pageID},null);this.props.onManageSavedResponses();};m.prototype.$SavedResponsesBrowseListView7=function(){'use strict';c('PagesEventObserver').logData_DEPRECATED({event_name:c('PagesEventType').SAVED_REPLIES_CREATE_REPLY_FROM_BROWSE_VIEW,page_id:this.props.pageID},null);this.props.onCreateNewSavedResponse();};m.propTypes={onCreateNewSavedResponse:l.func.isRequired,onManageSavedResponses:l.func.isRequired,onResponseHover:l.func.isRequired,onResponseSelected:l.func.isRequired,onResponseUnhover:l.func.isRequired,otherUserID:l.string.isRequired,pageID:l.string.isRequired};f.exports=m;}),null);
__d('SavedResponsesBrowsePanel.react',['cx','fbt','PagesEventObserver','PagesEventType','React','SavedResponsesBrowseListView.react','SavedResponsesPanel.react'],(function a(b,c,d,e,f,g,h,i){'use strict';var j,k;if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes;j=babelHelpers.inherits(m,c('React').Component);k=j&&j.prototype;function m(n,o){k.constructor.call(this,n,o);}m.prototype.render=function(){return (c('React').createElement(c('SavedResponsesPanel.react'),{className:"_33oq",onClose:this.props.onClose,title:this.getTitle()},this.renderBody()));};m.prototype.getTitle=function(){return i._("Respuestas guardadas");};m.prototype.refreshSavedResponsesList=function(){this.refs.savedResponsesListView&&this.refs.savedResponsesListView.refreshSavedResponsesList();};m.prototype.renderBody=function(){return (c('React').createElement(c('SavedResponsesBrowseListView.react'),{onCreateNewSavedResponse:this.props.onCreateNewSavedResponse,onManageSavedResponses:this.props.onManageSavedResponses,onResponseHover:this.props.onResponseHover,onResponseSelected:function(n,o){return (this.$SavedResponsesBrowsePanel1(n,o));}.bind(this),onResponseUnhover:this.props.onResponseUnhover,otherUserID:this.props.otherUserID,pageID:this.props.pageID,ref:'savedResponsesListView'}));};m.prototype.$SavedResponsesBrowsePanel2=function(){c('PagesEventObserver').logData_DEPRECATED({event_name:c('PagesEventType').SAVED_REPLIES_CLOSE_BROWSE_VIEW,page_id:this.props.pageID},null);this.props.onClose();};m.prototype.$SavedResponsesBrowsePanel1=function(n,o){c('PagesEventObserver').logData_DEPRECATED({event_name:c('PagesEventType').SAVED_REPLIES_APPLY_REPLY,page_id:this.props.pageID},null);this.props.onResponseSelected(n,o);};m.propTypes={onClose:l.func.isRequired,onCreateNewSavedResponse:l.func.isRequired,onManageSavedResponses:l.func.isRequired,onResponseHover:l.func.isRequired,onResponseSelected:l.func.isRequired,onResponseUnhover:l.func.isRequired,otherUserID:l.string.isRequired,pageID:l.string.isRequired};f.exports=m;}),null);
__d('PagesMessengerThreadDialogMixin',['cx','fbt','ActorURI','AsyncRequest','ChatTypingIndicators.react','Event','Grid.react','HovercardLink','immutable','Keys','LoadingIndicator.react','MercuryIDs','MercuryMessages','MercuryPageThreadActions','MercuryPayloadSource','MercuryRoger','MercuryThreadInformer','MessageList.react','MessengerCollapsedLogMessageGroup.react','MessengerDateBreak.react','MessengerLogMessage.react','MessengerMessageGroup.react','MessengerPresenceStatus.react','MessengerPresenceStatusUtils','MessengerTypingIndicator.react','PagesEventObserver','PagesEventType','PagesMessagingActionPlacement','PagesMessengerButtonSet.react','PagesMessengerComposer.react','PagesMessengerConfirmCloseThreadDialog.react','PagesMessengerMessage.react','PagesMessengerThreadUtils','MercuryParticipants','React','MercuryShareAttachmentRenderLocations','SavedResponsesBrowsePanel.react','SavedResponsesConstants','SavedResponsesManagePanel.react','SavedResponsesTokensUtils','ScrollableArea.react','Set','URI','XPagesSavedResponsesImageDuplicationController','XUIAbstractGlyphButton.react','XUICloseButton.react','XUIDialog.react','XUIDialogBody.react','XUIDialogTitle.react','emptyFunction','getViewportDimensions'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();var j=c('Grid.react').GridItem,k=c('React').PropTypes,l=10,m=10,n=500,o=318,p=.7,q={propTypes:{basePermalinkURI:k.string.isRequired,enableSuggestedResponse:k.bool.isRequired,flowID:k.string,pagesMessengerComposerProps:k.shape({isPageAdminNoteEnabled:k.bool.isRequired,isSavedResponseEnabled:k.bool.isRequired}).isRequired,threadID:k.string.isRequired,userID:k.string,disableComposer:k.bool},getDefaultProps:function r(){return {basePermalinkURI:"",disableComposer:true};},getInitialState:function r(){return {_mercuryRoger:c('MercuryRoger').getForFBID(this.props.userID),_messages:c('MercuryMessages').getForFBID(this.props.userID),_threadActions:c('MercuryPageThreadActions').getForFBID(this.props.userID),_threadInformer:c('MercuryThreadInformer').getForFBID(this.props.userID),hovercardLink:'',immutableMessages:c('immutable').List(),initDialog:false,initialSavedResponsesManageViewType:c('SavedResponsesConstants').editPanelViewMode.LIST,isMessengerComposerOn:true,isSavedResponsesBrowsePanelOn:this.props.pagesMessengerComposerProps.isSavedResponseEnabled,loadingMessages:false,messages:[],moreMessages:false,serverThreadID:null,showCloseDialog:false,thread:null,threadDialogExpanded:false};},getPermalinkURI:function r(){var s=c('URI').getRequestURI();if(this.props.basePermalinkURI)s=s.setPath(this.props.basePermalinkURI);s.addQueryData({index:this.props.index,threadid:this.state.serverThreadID,timestamp:this.state.thread.timestamp});return s;},_addURLParam:function r(){window.history.replaceState({},null,this.getPermalinkURI());},_clearURLParam:function r(){var s=c('URI').getRequestURI();s.removeQueryData('index');s.removeQueryData('threadid');s.removeQueryData('timestamp');window.history.replaceState({},null,s);},_displayErrorMessage:function r(s){var t=c('React').createElement('div',{className:"_jbx"},i._("Espera hasta que se suba el archivo antes de enviar tu mensaje."));if(s){this.setState({errorMessage:t});}else this.setState({errorMessage:null});},_fetchMessages:function r(s,t){if(!s||this.state.loadingMessages)return;this.setState({loadingMessages:true});this.state._messages.getThreadMessagesRange(this.props.threadID,this.state.messages.length,s+1,function(u){var v=u.length>s,w=v?u.slice(1):u;if(u.length){this._oldTimestamp=u[0].timestamp;}else this._oldTimestamp=0;t=t||c('emptyFunction');u=w.concat(this.state.messages);this._setMessageState(u);this.setState({moreMessages:v,loadingMessages:false},t);this._updateSuggestedResponse&&this._updateSuggestedResponse();if(this.state.messages.length<=l){this._scrollToBottom();}else this._maintainScrollView(this._prevScrollHeight,this._prevScrollTop);this._setPrevScroll();}.bind(this));},_fetchEarlierMessages:function r(){this._setPreventScroll();this._fetchMessages(m);},_getComposerSize:function r(){if(this.state.threadDialogExpanded){var s=c('getViewportDimensions')();return {height:p*s.height,width:p*s.width};}else return {height:o,width:n};},_calculateReceipts:function r(s){var t=this.state._mercuryRoger.getSeenTimestamps(this.props.threadID),u=new (c('Set'))(t.keys());return t.withMutations(function(v){var w=s?s:this.state.messages;c('immutable').Seq(w).reverse().forEach(function(x){if(u.size===0)return false;if(!u.has(x.author))return;v.update(x.author,function(y){if(!y||y.watermark<=x.timestamp)return {watermark:x.timestamp,action:x.timestamp};return y;});u['delete'](x.author);});}.bind(this));},_maintainScrollView:function r(s,t){if(!this.refs.scrollContainer)return;var u=this.refs.scrollContainer.getArea(),v=u.getScrollHeight()-s+t;u.setScrollTop(v,false);},_openMessageDialog:function r(event){if(this.state.showDialog)return;c('PagesEventObserver').logData_DEPRECATED({event_name:c('PagesEventType').MESSAGES_VIEW_THREAD,page_id:this.props.userID,source:this.props.source,thread_id:this.state.serverThreadID});this.setState({showDialog:true,initDialog:true});if(this.state.messages.length===0){c('PagesEventObserver').logData_DEPRECATED({event_name:c('PagesEventType').MESSAGES_MESSAGELIST_LOAD_START,flowID:this.props.flowID,page_id:this.props.userID,subsection:this.props.folder,loading_event_time:Date.now()});this._fetchMessages(m,this.logGotMessageEvent);}this.refs.savedResponsesBrowsePanel&&this.refs.savedResponsesBrowsePanel.refreshSavedResponsesList();this._addURLParam();},_onDeleteMessageAction:function r(s){if(s){this.state._threadActions['delete'](this.props.threadID);}else{this.state._messageActions['delete'](this.props.threadID,Object.keys(this.state.selectedMessages),c('MercuryPayloadSource').CLIENT_DELETE_MESSAGES);this.setState({selectedMessages:{}});}this._updateDeleteActionState();},_onScroll:function r(){if(!this.refs.scrollContainer)return;var s=this.refs.scrollContainer.getArea(),t=this._prevScrollTop,u=this._prevScrollHeight;this._setPrevScroll();if(s.isScrolledToTop()){this._fetchEarlierMessages();}else if(s.isScrolledToBottom()){this._setAllowScroll();}else{if(s.getScrollTop()===t&&s.getScrollHeight()!==u)this._maintainScrollView(u,t);this._setPreventScroll();}},componentWillMount:function r(){this.setState({readReceipts:this._calculateReceipts()});this.state._mercuryRoger.subscribe('change',function(s,t){t[this.props.threadID]&&this.state.initDialog&&this.setState({readReceipts:this._calculateReceipts()});}.bind(this));this._messagesReceivedToken=this.state._threadInformer.subscribe('messages-received',function(s,t){if(this._shouldHandleMessageReceived&&!this._shouldHandleMessageReceived())return;var u=t[this.props.threadID];if(!u||!u.length)return;this._setMessageState(this.state.messages.concat(u),function(){this._afterThreadReceived&&this._afterThreadReceived();}.bind(this));}.bind(this));this._messagesReorderToken=this.state._threadInformer.subscribe('messages-reordered',function(s,t){var u=this.state._messages.getThreadMessagesSinceTimestamp(this.props.threadID,this._oldTimestamp);this._setMessageState(u);}.bind(this));this._messagesUpdatedToken=this.state._threadInformer.subscribe('messages-updated',function(s,t){var u=t[this.props.threadID];if(u){var v=this.state._messages.getMessagesFromIDs(Object.keys(u));if(v.length>0)this._updateMessages(v);}}.bind(this));},componentWillUnmount:function r(){this.state._threadInformer.unsubscribe(this._messagesReceivedToken);this.state._threadInformer.unsubscribe(this._messagesReorderToken);this.state._threadInformer.unsubscribe(this._messagesUpdatedToken);},componentDidUpdate:function r(s,t){if(!this.state.showDialog)return;if(!t.showDialog&&this.state.showDialog&&this.state.messages.length){var u=this.refs.scrollContainer.getArea();u.setScrollTop(this._prevScrollHeight);}if(this.refs.threadDialog)setTimeout(this.refs.threadDialog.layer.updatePosition.bind(this.refs.threadDialog.layer));if(this.refs.threadDialog&&!this._threadDialogSubscribed){this.refs.threadDialog.layerSubscribe('key',this._onDialogKey);this._threadDialogSubscribed=true;}this.renderDialogTitle();},componentWillUpdate:function r(s,t){if(t.messages!=this.state.messages)this.setState({readReceipts:this._calculateReceipts(t.messages)});if(!this.state.initDialog&&t.initDialog){this.setState({hovercardLink:c('HovercardLink').constructEndpoint({id:this.state.thread.other_user_fbid})});c('MercuryParticipants').get(c('MercuryIDs').getParticipantIDFromUserID(this.state.thread.other_user_fbid),function(u){var v;this.setState({participants:c('immutable').Map((v={},v[u.id]=u,v))});}.bind(this));}},_onDialogKey:function r(s,event){if(c('Event').getKeyCode(event)===c('Keys').ESC)setTimeout(this._onCloseButton);},_onComposerKey:function r(event){if(c('Event').getKeyCode(event)===c('Keys').ESC)setTimeout(this._onCloseButton);},_logExpandedWindow:function r(){if(this.state.threadDialogExpanded)c('PagesEventObserver').logData_DEPRECATED({page_id:this.props.userID,event_name:c('PagesEventType').MESSAGES_DIALOG_EXPAND_WINDOW,source:this.props.source,thread_id:this.state.serverThreadID});},_onToggleDialogSize:function r(){this.setState({threadDialogExpanded:!this.state.threadDialogExpanded},this._logExpandedWindow);},_onToggleDialog:function r(s){if(!this.props.disableComposer&&this.refs.composer.hasInput()){this.setState({showCloseDialog:true});}else this._onToggleDialogNoComposerCheck(s);if(!s){this._clearURLParam();this.state._threadActions.markRead(this.props.threadID,c('PagesMessagingActionPlacement').MESSAGE_DIALOG_OPENING);}},_onToggleDialogNoComposerCheck:function r(s){this.setState({threadDialogExpanded:!s?false:this.state.threadDialogExpanded,showDialog:s,showCloseDialog:false},this._logExpandedWindow);},_onCloseButton:function r(){this._onToggleDialog(false);},_onCloseSavedResponsesBrowsePanel:function r(){this.setState({isSavedResponsesBrowsePanelOn:false});},_onConfirmCloseButton:function r(){if(!this.props.disableComposer)this.refs.composer.clearInput();this._onToggleDialogNoComposerCheck(false);},_onCancelCloseButton:function r(){this.setState({showCloseDialog:false});},_onSavedResponseSelected:function r(s,t){if(this.props.disableComposer)return;if(s.image){var u=c('XPagesSavedResponsesImageDuplicationController').getURIBuilder().getURI();u=c('ActorURI').create(u,this.props.userID);new (c('AsyncRequest'))().setURI(u).setMethod('POST').setData({image_id:s.image.id}).setHandler(function(v){var w=v.payload.duplicatedImageID;this.refs.composer.setSavedResponse(c('SavedResponsesTokensUtils').prepareforSend(s.message,t),w);}.bind(this)).send();}else this.refs.composer.setSavedResponse(c('SavedResponsesTokensUtils').prepareforSend(s.message,t),null);},_onSavedResponseHover:function r(s,t){if(!this.props.disableComposer){var u=c('SavedResponsesTokensUtils').prepareforSend(s.message,t);this.refs.composer.setPlaceholderText(u);}},_onSavedResponseUnhover:function r(){if(!this.props.disableComposer)this.refs.composer.setPlaceholderText(null);},_onMessageCheckStatusChanged:function r(event){var s=this.state.selectedMessages;if(event.target.checked){s[event.target.value]=true;}else delete s[event.target.value];this.setState({selectedMessages:s});this._updateDeleteActionState();},_scrollToBottom:function r(){if(!this.state.allowScroll||!this.refs.scrollContainer)return false;var s=this.refs.scrollContainer.getArea();s.scrollToBottom(false);return true;},_setAllowScroll:function r(){if(!this.state.allowScroll)this.setState({allowScroll:true});},_setMessageState:function r(s,t){t=t||c('emptyFunction');this.setState({immutableMessages:c('immutable').List(s),messages:s},t);},_setPreventScroll:function r(){if(this.state.allowScroll)this.setState({allowScroll:false});},_setPrevScroll:function r(){var s=this.refs.scrollContainer;this._prevScrollHeight=s?s.getArea().getScrollHeight():0;this._prevScrollTop=s?s.getArea().getScrollTop():0;},_updateMessages:function r(s,t){var u=this.state.messages;s.forEach(function(v){var w=this.state.messages.findIndex(function(x){return x.message_id===v.message_id;});if(w)u[w]=v;}.bind(this));this._setMessageState(u,t);this._maintainScrollView(this._prevScrollHeight,this._prevScrollTop);this._setPrevScroll();},_updateDeleteActionState:function r(){if(Object.keys(this.state.selectedMessages).length===0){this.setState({isDeleteButtonDisabled:true});}else this.setState({isDeleteButtonDisabled:false});},_onSavedResponsesButtonClicked:function r(){c('PagesEventObserver').logData_DEPRECATED({event_name:c('PagesEventType').SAVED_REPLIES_TOGGLE_BROWSE_VIEW,page_id:this.props.pageID,toggle_on:!this.state.isSavedResponsesBrowsePanelOn});this.setState({isSavedResponsesBrowsePanelOn:!this.state.isSavedResponsesBrowsePanelOn});},_onManageSavedResponses:function r(){this.setState({isSavedResponsesManagePanelOn:true,isSavedResponsesBrowsePanelOn:false,isMessengerComposerOn:false,initialSavedResponsesManageViewType:c('SavedResponsesConstants').editPanelViewMode.LIST});},_onCreateNewSavedResponse:function r(){this.setState({isSavedResponsesManagePanelOn:true,isSavedResponsesBrowsePanelOn:false,isMessengerComposerOn:false,initialSavedResponsesManageViewType:c('SavedResponsesConstants').editPanelViewMode.CREATE});},_getTotalDialogWidth:function r(s){if(this.state.isSavedResponsesBrowsePanelOn){return s.width+c('SavedResponsesConstants').browsePanelAttachModeWidth;}else if(this.state.isSavedResponsesManagePanelOn){return c('SavedResponsesConstants').editPanelDialogWidth;}else return s.width;},_onCloseSavedResponsesManagePanel:function r(){this.setState({isSavedResponsesManagePanelOn:false,isSavedResponsesBrowsePanelOn:true,isMessengerComposerOn:true});},logGotMessageEvent:function r(){c('PagesEventObserver').logData_DEPRECATED({page_id:this.props.userID,event_name:c('PagesEventType').MESSAGES_DIALOG_GOTMESSAGES,thread_id:this.state.serverThreadID,message_count:this.state.messages.length});c('PagesEventObserver').logData_DEPRECATED({event_name:c('PagesEventType').MESSAGES_MESSAGELIST_LOAD_END,flowID:this.props.flowID,page_id:this.props.userID,subsection:this.props.folder,loading_event_time:Date.now()});},renderActionsButton:function r(){return (c('React').createElement('div',{className:"_5vuo"},c('React').createElement(c('PagesMessengerButtonSet.react'),{isDeleteButtonDisabled:this.state.isDeleteButtonDisabled,user:this.props.userID,onDeleteMessageAction:this._onDeleteMessageAction,threadID:this.props.threadID,threadElementID:this.state.serverThreadID,folder:this.props.folder,thread:this.state.thread,allowReport:this.props.allowReport})));},renderExpandButton:function r(){var s=this.state.threadDialogExpanded?i._("Salir de la vista ampliada"):i._("Entrar en la vista ampliada"),t=i._("Mostrar u ocultar vista ampliada");return (c('React').createElement(c('XUIAbstractGlyphButton.react'),{className:(this.state.threadDialogExpanded?"_5bwk":'')+(!this.state.threadDialogExpanded?' '+"_5bwl":''),'data-hover':'tooltip','data-tooltip-alignh':'center','data-tooltip-content':s,label:t,onClick:this._onToggleDialogSize,ref:'expandButton',size:'medium',title:t,type:'button'}));},renderAttachmentShelf:function r(){return (c('React').createElement('div',{ref:'attachmentsShelf',className:"_jz4"}));},renderErrorMessage:function r(){return c('React').createElement('div',null,this.state.errorMessage);},renderComposer:function r(){if(this.props.disableComposer)return null;return (c('React').createElement(c('PagesMessengerComposer.react'),babelHelpers['extends']({},this.props.pagesMessengerComposerProps,{attachmentsShelf:this.refs.attachmentsShelf,creatorInfo:this.props.creatorInfo,displayErrorMessage:this._displayErrorMessage,fileAttachmentEnabled:true,linkPreviewEnabled:true,onBeforeSend:this._setAllowScroll,onKeyUp:this._onComposerKey,otherUserID:this.state.thread.other_user_fbid.toString(),ref:'composer',threadID:this.props.threadID,threadElementID:this.state.serverThreadID,user:this.props.userID,suggestedResponseHandler:this.state.suggestedResponseHandler,isSuggestedResponseEnabled:this.props.enableSuggestedResponse,isSavedResponsesBrowsePanelOn:this.state.isSavedResponsesBrowsePanelOn,onSavedResponsesButtonClicked:this._onSavedResponsesButtonClicked})));},renderCloseButton:function r(){var s=i._("Cerrar"),t=i._("Presiona Esc para cerrar");return (c('React').createElement(c('XUICloseButton.react'),{label:s,onClick:this._onCloseButton,shade:'dark',size:'medium',title:s,tooltip:t,type:'button'}));},renderComposerPart:function r(s){return (c('React').createElement('div',null,c('React').createElement(c('XUIDialogTitle.react'),{className:"_3alh",showCloseButton:false},c('React').createElement('div',null,c('React').createElement('a',{className:"_5hp9",ref:'shortThreadName','data-hovercard':this.state.hovercardLink}),this.renderPresenceStatus()),this.renderActionsButton(),this.renderExpandButton(),this.renderCloseButton()),c('React').createElement(c('XUIDialogBody.react'),{className:c('PagesMessengerThreadUtils').isFlagThread(this.state.thread)?"_5s71":'',useCustomPadding:true},c('React').createElement(c('ScrollableArea.react'),{height:s.height,onScroll:this._onScroll,ref:'scrollContainer',width:s.width},this.renderLoadingMessages(),this.renderMessages())),this.renderErrorMessage(),this.renderAttachmentShelf(),this.renderComposer()));},renderDialogContent:function r(s){return (c('React').createElement('div',null,this.renderSavedResponsesManagePanel(),this.renderComposerAndBrowsePanel(s)));},renderSavedResponsesManagePanel:function r(){if(this.state.isSavedResponsesManagePanelOn){return (c('React').createElement(c('SavedResponsesManagePanel.react'),{onClose:this._onCloseSavedResponsesManagePanel,pageID:this.props.userID,otherUserID:this.state.thread.other_user_fbid.toString(),initialViewType:this.state.initialSavedResponsesManageViewType}));}else return null;},renderSavedResponsesBrowserPanel:function r(){if(!this.state.isSavedResponsesBrowsePanelOn)return null;return (c('React').createElement(c('SavedResponsesBrowsePanel.react'),{onClose:this._onCloseSavedResponsesBrowsePanel,otherUserID:this.state.thread.other_user_fbid.toString(),onManageSavedResponses:this._onManageSavedResponses,onCreateNewSavedResponse:this._onCreateNewSavedResponse,onResponseSelected:this._onSavedResponseSelected,onResponseHover:function(s,t){return this._onSavedResponseHover(s,t);}.bind(this),onResponseUnhover:this._onSavedResponseUnhover,pageID:this.props.userID,ref:'savedResponsesBrowsePanel'}));},renderComposerAndBrowsePanel:function r(s){var t={maxWidth:s.width};return (c('React').createElement(c('Grid.react'),{cols:2,spacing:'none',className:(!this.state.isMessengerComposerOn?"hidden_elem":'')+(' '+"_5b17")},c('React').createElement(j,{className:"_jz7"+(!this.state.isSavedResponsesBrowsePanelOn?' '+"hidden_elem":'')},this.renderSavedResponsesBrowserPanel()),c('React').createElement(j,{style:t,className:"_jz7"+(!this.state.isMessengerComposerOn?' '+"hidden_elem":'')},this.renderComposerPart(s))));},renderLayers:function r(){if(!this.state.initDialog)return null;var s=this._getComposerSize();return {threadDialog:c('React').createElement(c('XUIDialog.react'),{layerHideOnBlur:false,ref:'threadDialog',shown:this.state.showDialog,width:this._getTotalDialogWidth(s)},this.renderDialogContent(s)),closeThreadDialog:c('React').createElement(c('PagesMessengerConfirmCloseThreadDialog.react'),{shown:this.state.showCloseDialog,onCancel:this._onCancelCloseButton,onConfirm:this._onConfirmCloseButton})};},renderLoadingMessages:function r(){if(this.state.loadingMessages)return (c('React').createElement('div',{className:"_3oly _2ph-"},c('React').createElement(c('LoadingIndicator.react'),{size:'medium',color:'white'})));},renderMessages:function r(){if(!this.state.messages)return null;return (c('React').createElement('div',{className:"_511c _1ej0 _2mpc"},c('React').createElement(c('MessageList.react'),{DateBreak:c('MessengerDateBreak.react'),deliveryTimestamp:0,isCanonical:true,isPageMessage:true,location:c('MercuryShareAttachmentRenderLocations').MESSENGER,LogMessage:c('MessengerLogMessage.react'),CollapsedLogMessageGroup:c('MessengerCollapsedLogMessageGroup.react'),MessageGroup:c('MessengerMessageGroup.react'),messages:this.state.immutableMessages,readReceipts:this.state.readReceipts,viewer:this.props.userID}),c('React').createElement(c('ChatTypingIndicators.react'),{indicatorClass:c('MessengerTypingIndicator.react'),indicatorsWillShow:function s(){},indicatorsDidShow:function(){this.refs.scrollContainer&&this.refs.scrollContainer.getArea().scrollToBottom();}.bind(this),rootClassName:"clearfix _17pz _4gv2",threadID:this.props.threadID,viewer:this.props.userID})));},renderMessage:function r(s){return (c('React').createElement(c('PagesMessengerMessage.react'),{customDialogWidth:this._getComposerSize().width,user:this.props.userID,message:s,key:s.message_id,messageCheckStatusChangedHandler:this._onMessageCheckStatusChanged}));},renderPresenceStatus:function r(s){if(!this.state.participants)return null;var t=c('MessengerPresenceStatusUtils').getStatusFromCanonicalThread(this.state.participants,this.state.thread);if(!t)return null;return (c('React').createElement(c('MessengerPresenceStatus.react'),{className:"_2v6o _8m4",isUserActive:t.isUserActive,lastActive:t.lastActive,platform:t.platform}));}};f.exports=q;}),null);
__d("XPagesMessagingPreferredAudienceXController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/pages\/messaging\/preferred_audience\/",{page_id:{type:"Int",required:true},other_user_id:{type:"Int",required:true}});}),null);
__d("XPagesPreferredAudienceDialogController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/pages\/preferred_audience_dialog\/",{user_id:{type:"Int",required:true}});}),null);
__d('PagesMessengerThreadRow.react',['cx','fbt','invariant','AsyncRequest','ActorURI','AdsTargetingTogglerSafeMixin','DOM','Image.react','Link.react','PagesAdminToolUIActionType','PagesManagerLogger','PagesMessagingActionPlacement','MessagingTag','MercuryIDs','MercuryMessageActions','MercuryThreadIDMap','MercuryThreadImage.react','MercuryThreadMetadataRawRenderer','MercuryThreadMetadataRenderer','MercuryThreads','MercuryTimestamp','MercuryMessageRenderer','PagesMessengerActions','PagesMessageSuggestedResponseHandler','PagesMessengerThreadUtils','PagesMessengerThreadDialogMixin','MercuryParticipants','React','ReactDOM','ReactLayeredComponentMixin_DEPRECATED','Token.react','XPagesMessagingPreferredAudienceXController','XPagesPreferredAudienceDialogController','XUICheckboxInput.react','XUIText.react','emptyFunction'],(function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k=c('React').PropTypes,l=36,m=c('React').createClass({displayName:'PagesMessengerThreadRow',mixins:[c('ReactLayeredComponentMixin_DEPRECATED'),c('AdsTargetingTogglerSafeMixin'),c('PagesMessengerThreadDialogMixin')],propTypes:{checkBoxDisable:k.bool,creatorInfo:k.object,customMessage:k.object,folder:k.string.isRequired,index:k.number,onCheckBoxChanged:k.func,selected:k.bool.isRequired,showActionButton:k.bool.isRequired,showDialog:k.bool.isRequired,source:k.string.isRequired,allowReport:k.bool.isRequired},getDefaultProps:function n(){return {allowReport:false,checkBoxDisable:false,enableSuggestedResponse:false,onCheckBoxChanged:c('emptyFunction'),pagesMessengerComposerProps:{isPageAdminNoteEnabled:false,isSavedResponseEnabled:false},selected:false,showActionButton:false,showDialog:false};},getInitialState:function n(){return {_threads:c('MercuryThreads').getForFBID(this.props.userID),_messageActions:c('MercuryMessageActions').getForFBID(this.props.userID),_threadMetadataRenderer:c('MercuryThreadMetadataRenderer').getForFBID(this.props.userID),_threadIDMap:c('MercuryThreadIDMap').getForFBID(this.props.userID),checkBoxSelected:false,selected:this.props.selected,selectedMessages:[],allowScroll:true,isDeleteButtonDisabled:true,showDialog:false,errorMessage:null,suggestedResponseHandler:null};},_updateSuggestedResponse:function n(){if(!this.props.enableSuggestedResponse||!this.state.messages.length)return;var o=this.state.messages[this.state.messages.length-1];if(o&&c('MercuryIDs').getUserIDFromParticipantID(o.author)===this.props.userID){this.setState({suggestedResponseHandler:null});return;}this.setState({suggestedResponseHandler:new (c('PagesMessageSuggestedResponseHandler'))(o,this.props.userID)});},getServerThreadID:function n(o){var p=this.state._threadIDMap.getServerIDFromClientIDNow(o);return p?p:'user:'+o;},componentWillMount:function n(){this._prevScrollHeight=0;this._prevScrollTop=0;this.setState({serverThreadID:this.getServerThreadID(this.props.threadID)});this.state._threads.getThreadMeta(this.props.threadID,function(o){this.setState({thread:o});}.bind(this));},componentDidMount:function n(){if(this.props.customMessage){this.renderCustomMessage();}else{var o=this.state.thread;this.renderThreadMeta(o,{});}if(this.props.showDialog)this._openMessageDialog();},componentWillReceiveProps:function n(o){if(o.selected!=this.props.selected){this.props.onCheckBoxChanged(this.props.threadID,o.selected,this.state.thread);this.setState({checkBoxSelected:o.selected});}},componentWillUnmount:function n(){this.props.onCheckBoxChanged(this.props.threadID,false,this.state.thread);if(this._image)c('ReactDOM').unmountComponentAtNode(c('ReactDOM').findDOMNode(this.refs.image));},_onCheckBoxChange:function n(event){this.setState({checkBoxSelected:event.currentTarget.checked});this.props.onCheckBoxChanged(this.props.threadID,event.currentTarget.checked,this.state.thread);},_onInlineIconClick:function n(event){var o,p=event.target.getAttribute('data-key');switch(p){case c('PagesMessengerActions').ARCHIVE:o=this.state._threadActions.archive;break;case c('PagesMessengerActions').MARK_AS_READ:o=this.state._threadActions.markRead;break;case c('PagesMessengerActions').MARK_AS_UNREAD:o=this.state._threadActions.markUnread;break;default:j(0);}o.call(this.state._threadActions,this.props.threadID,c('PagesMessagingActionPlacement').SPRINGBOARD_INLINE_ACTION);c('PagesManagerLogger').logMessageInboxUIAction(c('PagesAdminToolUIActionType').MESSAGE_INBOX_CLICK_MENU_ACTION,this.props.pageID,{menu_action:p,position:c('PagesMessagingActionPlacement').SPRINGBOARD_INLINE_ACTION});event.preventDefault();event.stopPropagation();},updateThread:function n(){this.state._threads.getThreadMeta(this.props.threadID,function(o){this.setState({thread:o});var p=c('MercuryTimestamp').getFormatedTimestamp(o.timestamp),q={timestamp_absolute:p.absolute,timestamp_relative:p.relative,timestamp:o.timestamp};this.renderThreadMeta(o,{custom_timestamp:q});}.bind(this));},renderCustomMessage:function n(){var o=c('MercuryMessageRenderer').formatMessageBody(this.props.customMessage.body,this.props.customMessage.matched_keywords);c('DOM').setContent(c('ReactDOM').findDOMNode(this.refs.snippet),o);c('MercuryParticipants').get(this.props.customMessage.author,function(p){c('DOM').setContent(c('ReactDOM').findDOMNode(this.refs.core),p.short_name);var q=c('React').createElement(c('Image.react'),{height:l,src:p.image_src,width:l});if(p.href)q=c('React').createElement(c('Link.react'),{href:p.href},q);c('ReactDOM').render(q,c('ReactDOM').findDOMNode(this.refs.image));}.bind(this));this.state._threadMetadataRenderer.renderTimestamp(c('ReactDOM').findDOMNode(this.refs.timestamp),this.props.customMessage.timestamp_absolute,this.props.customMessage.timestamp_relative,this.props.customMessage.timestamp);},renderThreadMeta:function n(o,p){p=p||{};c('DOM').setContent(c('ReactDOM').findDOMNode(this.refs.snippet),null);this.state._threadMetadataRenderer.renderSnippet(o,c('ReactDOM').findDOMNode(this.refs.snippet));this.state._threadMetadataRenderer.renderAndSeparatedParticipantList(this.props.threadID,c('ReactDOM').findDOMNode(this.refs.core),{show_unread_count:true});this._image=c('ReactDOM').render(c('React').createElement(c('MercuryThreadImage.react'),{size:l,thread:o,viewer:this.props.userID}),c('ReactDOM').findDOMNode(this.refs.image));var q=p.custom_timestamp?p.custom_timestamp:o;this.state._threadMetadataRenderer.renderTimestamp(c('ReactDOM').findDOMNode(this.refs.timestamp),q.timestamp_absolute,q.timestamp_relative,q.timestamp);},renderDialogTitle:function n(){if(!this.refs.shortThreadName||this._dialogThreadNameRendered)return;this.state._threadMetadataRenderer.renderAndSeparatedParticipantList(this.props.threadID,c('ReactDOM').findDOMNode(this.refs.shortThreadName),{names_renderer:c('MercuryThreadMetadataRawRenderer').renderShortNames,check_length:true});this._dialogThreadNameRendered=true;},renderActionButton:function n(){if(!this.props.showActionButton||this.props.folder!=c('MessagingTag').INBOX)return null;var o=null,p=null,q=true;if(this.state.thread.unread_count>0){o=i._("Marcar como le\u00eddo");p="_4k83";}else{q=false;o=i._("Marcar como no le\u00eddo");p="_4k84";}return (c('React').createElement('div',{className:"_54rz"},c('React').createElement('div',{'aria-label':o,className:p,'data-hover':'tooltip','data-tooltip-content':o,'data-key':q?c('PagesMessengerActions').MARK_AS_READ:c('PagesMessengerActions').MARK_AS_UNREAD,onClick:this._onInlineIconClick}),c('React').createElement('div',{'aria-label':i._("Archivar"),className:"_4k82",'data-hover':'tooltip','data-tooltip-content':i._("Archivar"),'data-key':c('PagesMessengerActions').ARCHIVE,onClick:this._onInlineIconClick})));},_shouldHandleMessageReceived:function n(){return this.state.initDialog;},_openPreferredAudienceDialog:function n(event){new (c('AsyncRequest'))().setURI(c('XPagesPreferredAudienceDialogController').getURIBuilder().setInt('user_id',this.props.userID).getURI()).send();event.preventDefault();event.stopPropagation();},_afterThreadReceived:function n(){if(this._scrollToBottom()&&this.state.showDialog)this.state._threadActions.markRead(this.props.threadID,c('PagesMessagingActionPlacement').MESSAGE_DIALOG_SHOWN);this._updateSuggestedResponse();},render:function n(){var o=(this.state.thread.unread_count>0&&!this.state.checkBoxSelected?"_4k85":'')+(this.state.checkBoxSelected?' '+"_ib2":'')+(' '+"_5dxh")+(c('PagesMessengerThreadUtils').isFlagThread(this.state.thread)?' '+"_1md7":'');return (c('React').createElement('li',{className:o},c('React').createElement('div',{className:"_50jh"},c('React').createElement(c('XUICheckboxInput.react'),{checked:this.state.checkBoxSelected,disabled:this.props.checkBoxDisable,className:"_ib3",onChange:this._onCheckBoxChange}),c('React').createElement('a',{href:this.getPermalinkURI(),onClick:function p(q){q.preventDefault();}},c('React').createElement('div',{className:"_3iqj",onClick:this._openMessageDialog},c('React').createElement('div',{className:"_3iqk"},c('React').createElement('div',{ref:'image',className:"_50ji"}),c('React').createElement('div',{className:"_50jk"},c('React').createElement(c('XUIText.react'),{ref:'core',weight:'bold',className:"_3gdp"}),c('React').createElement('div',{ref:'snippet',className:"_50jm"}))),c('React').createElement('div',{className:"rfloat"},this.state.enablePreferredAudience?c('React').createElement('span',{className:"_587a",onClick:this._openPreferredAudienceDialog},c('React').createElement(c('Token.react'),{label:'Preferred Audience'})):null,c('React').createElement('div',{ref:'timestamp',className:"_50jo"}),this.renderActionButton()))))));}});f.exports=m;}),null);
__d('PagesMessengerStore',['invariant','PagesMessengerActions','EventEmitter','PagesMessengerDispatcher'],(function a(b,c,d,e,f,g,h){var i,j;if(c.__markCompiled)c.__markCompiled();i=babelHelpers.inherits(k,c('EventEmitter'));j=i&&i.prototype;function k(){'use strict';j.constructor.call(this);this.$PagesMessengerStore1=true;this.$PagesMessengerStore2=c('PagesMessengerDispatcher').register(this.$PagesMessengerStore3.bind(this));}k.prototype.$PagesMessengerStore3=function(l){'use strict';switch(l.action.actionType){case c('PagesMessengerActions').ONVISIBLE_INIT:this.setVisible(l.visible);break;case c('PagesMessengerActions').ONVISIBLE_RESET:this.resetOnVisible();break;default:h(0);}};k.prototype.setVisible=function(l){'use strict';this.$PagesMessengerStore1=!l;};k.prototype.resetOnVisible=function(){'use strict';if(this.$PagesMessengerStore1){this.emit(c('PagesMessengerActions').ONVISIBLE_RESET);this.setVisible(false);}};f.exports=new k();}),null);
__d('PagesMessengerThreadlistMixin',['cx','fbt','invariant','ix','PagesMessengerActions','Image.react','MessagingTag','MercuryFilters','MercuryIDs','MercuryPageOrderedThreadlist','MercuryPagesChannelHandlerDEPRECATED','MercuryServerPayloadPreprocessor','MercuryThreadInformer','MercuryThreadlistConstants','MercuryThreads','PagesEventObserver','PagesEventType','PagesMessengerDispatcher','PagesMessengerStore','React','SubscriptionsHandler','XUISpinner.react','XUIText.react','emptyFunction','PagesMessagingConst'],(function a(b,c,d,e,f,g,h,i,j,k){if(c.__markCompiled)c.__markCompiled();var l=c('React').PropTypes,m=c('PagesMessagingConst').UNANSWERED_FILTER,n=10,o={propTypes:{creatorInfo:l.object,folder:l.oneOf([c('MessagingTag').ARCHIVED,c('MessagingTag').INBOX,c('MessagingTag').OTHER,c('MessagingTag').SPAM]).isRequired,initialData:l.object,pageID:l.string.isRequired,source:l.string.isRequired,initialClientFilter:l.string,flowID:l.string},getDefaultProps:function p(){return {folder:c('MessagingTag').INBOX,initialClientFilter:c('MercuryFilters').ALL};},getInitialState:function p(){c('MercuryPagesChannelHandlerDEPRECATED').getForFBID(this.props.pageID).turnOn();return {filter:c('MercuryFilters').ALL,clientFilter:this.props.initialClientFilter,loadingThreads:false,moreThreads:false,_mercuryThreads:c('MercuryThreads').getForFBID(this.props.pageID),_orderedThreadlist:new (c('MercuryPageOrderedThreadlist'))(this.props.pageID),_payloadPreprocessor:c('MercuryServerPayloadPreprocessor').getForFBID(this.props.pageID),_threadInformer:c('MercuryThreadInformer').getForFBID(this.props.pageID),threads:[],clientFilteredThreads:[]};},fetchMoreThreads:function p(q,r,s,t){this._fetchThreads(q,r,s,t,false);},refetchThreads:function p(q,r,s,t,u){this._fetchThreads(q,r,s,t,true,u);},fetchThreadUntilThreadFound:function p(q,r,s,t){this._fetchCount=1;this._fetchThreads(0,q,r,s,true,this.fetchThreadIfNoGivenThread);},fetchThreadIfNoGivenThread:function p(){this._fetchCount++;var q=this.state.threads.findIndex(function(r){return r===this.props.threadID;}.bind(this));if(q<0&&this._fetchCount<n)this._fetchThreads(this.state.threads.length,c('MercuryThreadlistConstants').WEBMESSENGER_THREAD_COUNT,this.getMercuryFolder(this.props.folder),this.state.filter,false,this.fetchThreadIfNoGivenThread);},applyClientFilters:function p(q){if(this.state.clientFilter!==m)return;this.state._mercuryThreads.getMultiThreadMeta(q,function(r){var s=[];Object.keys(r).forEach(function(t){var u=r[t];if(!u.snippet_sender)return;var v=c('MercuryIDs').getUserIDFromParticipantID(u.snippet_sender);if(v!==this.props.pageID)s.push(t);}.bind(this));this.setState({clientFilteredThreads:s});}.bind(this));},getMercuryFolder:function p(q){return q===c('MessagingTag').ARCHIVED?c('MessagingTag').ACTION_ARCHIVED:q;},logPageLoadEndEvent:function p(){var event;switch(this.props.folder){case c('MessagingTag').INBOX:event=c('PagesEventType').MESSAGES_INBOX_LOAD_END;break;case c('MessagingTag').ARCHIVED:event=c('PagesEventType').MESSAGES_ARCHIVED_LOAD_END;break;case c('MessagingTag').SPAM:event=c('PagesEventType').MESSAGES_SPAM_LOAD_END;break;case c('MessagingTag').OTHER:event=c('PagesEventType').MESSAGES_OTHER_LOAD_END;break;default:j(0);break;}c('PagesEventObserver').logData_DEPRECATED({event_name:event,page_id:this.props.pageID,source:this.props.source,flowID:this.props.flowID,loading_event_time:Date.now()});event=c('PagesEventType').MESSAGES_EMPTY_THREAD_LOADED;var q={subsection:this.props.folder};if(this.state.threads.length===0)c('PagesEventObserver').notify(event,this.props.pageID,q);},logPageEvent:function p(){var event;switch(this.props.folder){case c('MessagingTag').INBOX:event=c('PagesEventType').MESSAGES_VIEW_INBOX;break;case c('MessagingTag').ARCHIVED:event=c('PagesEventType').MESSAGES_VIEW_ARCHIVED;break;case c('MessagingTag').SPAM:event=c('PagesEventType').MESSAGES_VIEW_SPAM;break;case c('MessagingTag').OTHER:event=c('PagesEventType').MESSAGES_VIEW_OTHER;break;default:j(0);break;}c('PagesEventObserver').logData_DEPRECATED({event_name:event,page_id:this.props.pageID,source:this.props.source});},updateThreads:function p(){var q=this.state.threads.length,r=this.state._orderedThreadlist.getThreadlistUntilTimestamp(q<c('MercuryThreadlistConstants').WEBMESSENGER_THREAD_COUNT?0:this._oldTimestamp,this.getMercuryFolder(this.props.folder),this.state.filter);this.applyClientFilters(r);this.setState({threads:r});},_fetchThreads:function p(q,r,s,t,u,v){if(this.state.loadingThreads)return;this.setState({loadingThreads:true});v=v||c('emptyFunction');this.state._orderedThreadlist.getFilteredThreadlist(q,r+1,s,t,function(w,x){var y=x.length>r,z=y?x.slice(0,r):x;if(z.length>0){this.state._mercuryThreads.getThreadMeta(z[z.length-1],function(ba){this._oldTimestamp=ba.timestamp;}.bind(this));}else this._oldTimestamp=0;var aa=u?z:this.state.threads.concat(z);this.applyClientFilters(aa);this.setState({loadingThreads:false,moreThreads:y,threads:aa},w);}.bind(this,v));},componentWillMount:function p(){this.logPageEvent();this._threadListUpdatedToken=this.state._threadInformer.subscribe('threadlist-updated',this.updateThreads);this._threadsUpatedToken=this.state._threadInformer.subscribe('threads-updated',function(q,r){for(var s in r)if(this.refs[s])this.refs[s].updateThread();}.bind(this));},componentWillUpdate:function p(q,r){if(r.filter!==this.state.filter)c('PagesMessengerDispatcher').handleUpdateFromViewAction({actionType:c('PagesMessengerActions').ONVISIBLE_RESET});},componentWillUnmount:function p(){c('MercuryPagesChannelHandlerDEPRECATED').getForFBID(this.props.pageID).turnOff();this.state._threadInformer.unsubscribe(this._threadListUpdatedToken);this.state._threadInformer.unsubscribe(this._threadsUpatedToken);this._subscriptions.release();},componentDidMount:function p(){this._subscriptions=new (c('SubscriptionsHandler'))();this._subscriptions.addSubscriptions(c('PagesMessengerStore').addListener(c('PagesMessengerActions').ONVISIBLE_RESET,function(){if(this.refs.onvisible)this.refs.onvisible.reset();}.bind(this)));},renderEmptyThreads:function p(){var q=null;switch(this.props.folder){case c('MessagingTag').ARCHIVED:q=i._("No tienes mensajes archivados.");break;case c('MessagingTag').INBOX:q=i._("No tienes mensajes en la bandeja de entrada.");break;case c('MessagingTag').SPAM:q=i._("No tienes mensajes en la carpeta de spam.");break;case c('MessagingTag').OTHER:q=i._("No tienes mensajes en la carpeta \"Otros\".");break;default:break;}return (c('React').createElement('div',{className:"_5swj _2pi1"},c('React').createElement('div',null,c('React').createElement(c('Image.react'),{className:"_5we3",src:k('/images/pages/pages_manager/messages_blankstate.png')})),c('React').createElement('div',null,c('React').createElement(c('XUIText.react'),{weight:'bold'},q))));},renderInitialLoadingSpinner:function p(){return (c('React').createElement('div',{className:"_3oly _2ph-"},c('React').createElement(c('XUISpinner.react'),{background:'light',size:'large',paused:false})));},renderLoadingMoreThreadSpinner:function p(){if(this.state.loadingThreads&&this.state.threads.length)return (c('React').createElement('div',{className:"_3oly _2ph-"},c('React').createElement(c('XUISpinner.react'),{background:'light',size:'small',paused:false})));return c('React').createElement('div',null);}};f.exports=o;}),null);
__d('PagesMessengerSpringboardThreadlist.react',['cx','List.react','MercurySyncPageEnvironment','MercuryThreadlistConstants','PagesMessengerThreadlistMixin','PagesMessengerThreadRow.react','React','ScrollableArea.react','debounce','PagesMessagingConst'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=c('React').PropTypes,j=c('PagesMessagingConst').UNANSWERED_FILTER,k=350,l=c('React').createClass({displayName:'PagesMessengerSpringboardThreadlist',mixins:[c('PagesMessengerThreadlistMixin')],propTypes:{basePermalinkURI:i.string.isRequired,disableComposer:i.bool.isRequired},componentWillMount:function m(){c('MercurySyncPageEnvironment').setUp(this.props.pageID,this.props.initSyncSequenceID);this.refetchThreads(c('MercuryThreadlistConstants').RECENT_THREAD_OFFSET,c('MercuryThreadlistConstants').JEWEL_MORE_COUNT,this.getMercuryFolder(this.props.folder),this.state.filter);},componentWillUMount:function m(){c('MercurySyncPageEnvironment').tearDown(this.props.pageID);},_onScroll:function m(){if(!this.state.moreThreads)return;this.fetchMoreThreads(this.state.threads.length,c('MercuryThreadlistConstants').JEWEL_MORE_COUNT,this.getMercuryFolder(this.props.folder),this.state.filter);},renderThreadList:function m(){if(!this.state.threads.length)if(this.state.loadingThreads){return this.renderInitialLoadingSpinner();}else return this.renderEmptyThreads();var n=this.state.clientFilter===j?this.state.clientFilteredThreads:this.state.threads,o=n.map(this.renderThread);return (c('React').createElement(c('ScrollableArea.react'),{className:"_1w6z _1uni",height:k,onScroll:c('debounce')(this._onScroll),scrollbar:'nofade',shadow:false},c('React').createElement(c('List.react'),{spacing:'none'},o),this.renderLoadingMoreThreadSpinner()));},renderThread:function m(n,o){return (c('React').createElement(c('PagesMessengerThreadRow.react'),{basePermalinkURI:this.props.basePermalinkURI,disableComposer:this.props.disableComposer,folder:this.props.folder,index:o,key:n,ref:n,showActionButton:true,source:this.props.source,springboard:true,threadID:n,userID:this.props.pageID}));},render:function m(){return this.renderThreadList();}});f.exports=l;}),null);