if (self.CavalryLogger) { CavalryLogger.start_js(["VdNG1"]); }

__d('ViewportTrackingHooks',['Base64'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i=[],j={registerFeedObject:function k(l,m){h[l]=c('Base64').encode(m);},updateVisibleViewportObjects:function k(l){var m=[],n=false;for(var o=0;o<l.length;o++){var p=l[o],q=p.id;while(!(q in h)&&p.firstChild!=undefined&&p.firstChild.id!=undefined&&p.firstChild.id.startsWith("u_")){q=p.firstChild.id;p=p.firstChild;}if(q in h){m.push(h[q]);if(!(o in i)||i[o]!=h[q])n=true;}}if(!n&&i.length!=m.length)n=true;if(n){i=m;if(typeof __EXT__updateVisibleViewportObjects==='function')__EXT__updateVisibleViewportObjects(i);}}};f.exports=j;}),null);
__d('viewportTrackingBuilder',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=function i(j){var k=null;return {factory:j,singleton:function l(){if(!k)k=j.apply(undefined,arguments);return k;},clearSingleton:function l(){k=null;}};};f.exports=h;}),null);
__d('ViewportTracking',['cx','invariant','Arbiter','AsyncSignal','Banzai','BanzaiScuba','CSS','CurrentUser','DOM','DOMDimensions','Event','LitestandMessages','NavigationMessage','Run','SubscriptionsHandler','UserActivity','Vector','ViewportTrackingHelper','ViewportTrackingHooks','clickRefAction','collectDataAttributes','debounce','getElementPosition','getViewportDimensions','throttle','viewportTrackingBuilder','setTimeout'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=97,k=51,l='vpv',m=3,n=2,o=1,p=0,q=1,r=2,s=3,t=4;function u(x){this.cachedAllStories=[];this.cachedVisibleStories={init:false,data:{}};this.fireTimer=this.fireTimer.bind(this);this.logAnnotatedVPV=this.logAnnotatedVPV.bind(this);this.markStoryRead=this.markStoryRead.bind(this);this.behavior=x;}u.prototype.init=function(x){this.useBanzai=true;this.vpvDebug=!!x.vpv_debug;this.vpvdDebug=!!x.vpvd_debug;this.vpvdAnalysis=!!x.vpvd_analysis;this.trackingHooks=!!x.tracking_hooks;this.readStoryIDs={};this.annotatedStoryIDs={};this.minSizeToBeVisible=200;this.minFractionToBeVisibleForTimetracking=.5;this.scrollThrottlingInterval=100;this.mouseThrottlingInterval=100;this.keyboardThrottlingInterval=100;this.minTimeToReportImmediately=500;this.discardVPVDIntervalThreshold=90000;this.active_state_duration=1000;this.height_diff_to_change_state=25;this.focused_state_duration=3500;this.invalidateAllStoriesCache();this.cachedViewportHeight=c('getViewportDimensions')().height;this.isTimetrackingEnabled=false;this.activeStories={};this.userInactiveLock=false;this.userActivityPollerTimeoutID=-1;this._headLoadStoryCount=0;if(this.behavior.getDataFromConfig)this.behavior.getDataFromConfig(x,this);if(this.isTimetrackingEnabled){this.lastMouseX=-1;this.lastMouseY=-1;this.lastStreamY=-1;this.latestStreamYChangedTimeStamp=-1;this.userFocus=r;this.latestUserFocus=r;this.latestUserActivity='init';this.focusedStory=null;this.latestFocusedStory=null;this.latestActiveStory=null;this.totalVPVDuration={};}this.isLoose=!!x.is_loose;this.maxScrollPosition=0;if(x.tracking_duration_config){this.scrollThrottlingInterval=x.tracking_duration_config.scroll_throttling_interval;this.mouseThrottlingInterval=x.tracking_duration_config.mouse_throttling_interval;this.keyboardThrottlingInterval=x.tracking_duration_config.keyboard_throttling_interval;this.userActivityPollingInterval=x.tracking_duration_config.user_activity_polling_interval;this.timeToBeConsideredInactive=x.tracking_duration_config.time_to_be_considered_inactive;this.minFractionToBeVisibleForTimetracking=x.tracking_duration_config.min_fraction_to_be_visible;this.minTimeToReportImmediately=x.tracking_duration_config.min_time_to_report_immediately;this.active_state_duration=x.tracking_duration_config.active_state_duration;this.height_diff_to_change_state=x.tracking_duration_config.story_height_diff_to_change_state;this.focused_state_duration=x.tracking_duration_config.focused_state_duration;this.discardVPVDIntervalThreshold=x.tracking_duration_config.discard_vpvd_interval_threshold;}!(x.record_delay!==undefined)?i(0):void 0;var y,z=c('debounce')(this.fireTimer,x.record_delay,this);if(this.isLoose){this.minSizeToBeVisible=0;y=c('throttle')(function(){this.maxScrollPosition=Math.max(this.maxScrollPosition,c('Vector').getScrollPosition().y);z();}.bind(this));}else y=z;this.initialStories=this.getStoriesInView();this.initialStoriesLogged=false;if(this.annotatedVPVLogging)this.initialStories.forEach(this.logAnnotatedVPV,this);this.subscriptions=new (c('SubscriptionsHandler'))();this.subscriptions.addSubscriptions(this._getScrollListener(y),c('Event').listen(window,'resize',function(){this.invalidateVisibleStoriesCache();this.cachedViewportHeight=c('getViewportDimensions')().height;y();}.bind(this)),c('Event').listen(window,'focus',function(){if(this.isTimetrackingEnabled)this.updateTimeTrackingData(false,'window_focus');}.bind(this)),c('Event').listen(window,'blur',function(){if(this.isTimetrackingEnabled)this.updateTimeTrackingData(true,'window_blur');}.bind(this)),c('Arbiter').subscribe(c('NavigationMessage').NAVIGATION_BEGIN,this.cleanup.bind(this)),c('Arbiter').subscribe('Stream/totalHeadLoadedStories',function(da,ea){this._headLoadStoryCount=ea.count;}.bind(this)),c('Arbiter').subscribe(c('LitestandMessages').STORIES_INSERTED,function(){if(!this.initialStoriesLogged){var da=this.getStoriesInView();da.forEach(this.logAnnotatedVPV,this);}else y();if(this.isTimetrackingEnabled)this.updateTimeTrackingData(false,'stories_inserted');}.bind(this)));if(this.isTimetrackingEnabled&&this.behavior.getStream){this.updateTimeTrackingData(false,'init');var aa=c('throttle')(function(event){this.invalidateVisibleStoriesCache();this.handleScroll(event);}.bind(this),this.scrollThrottlingInterval),ba=c('throttle')(function(event){return this.handleKeyboard(event);}.bind(this),this.keyboardThrottlingInterval),ca=c('throttle')(function(event){return this.handleMouse(event);}.bind(this),this.mouseThrottlingInterval);this.subscriptions.addSubscriptions(c('Event').listen(window,'scroll',aa),c('Event').listen(document.documentElement,'DOMMouseScroll',aa),c('Event').listen(document.documentElement,'mousewheel',aa),c('Event').listen(document.documentElement,'keydown',ba),c('Event').listen(document.documentElement,'mouseover',ca),c('Event').listen(document.documentElement,'mousemove',ca),c('Event').listen(document.documentElement,'click',function(event){this.handleMouse(event);}.bind(this)),c('Arbiter').subscribe('Event/stop',function(da,ea){this.handleMouse(ea.event);}.bind(this)),c('Arbiter').subscribe('PhotoSnowlift.OPEN',function(){this.userFocus=s;this.handleLayers();}.bind(this)),c('Arbiter').subscribe('PhotoSnowlift.CLOSE',function(){this.userFocus=q;this.focusedStory=null;this.updateTimeTrackingData(false,'snowlift_close');}.bind(this)));this._userActivityPoller();}c('Run').onLeave(this.cleanup.bind(this));c('Run').onUnload(this.cleanup.bind(this));};u.prototype._getScrollListener=function(x){return c('Event').listen(window,'scroll',x);};u.prototype.cleanup=function(){if(this.subscriptions){this.subscriptions.release();this.subscriptions=null;}if(this.isTimetrackingEnabled){clearTimeout(this.userActivityPollerTimeoutID);this.updateTimeTrackingData(true,'cleanup');}if(this.annotatedVPVLogging){var x=this.getStoriesInView();x.forEach(this.logAnnotatedVPV,this);}this.initialStories=[];this._headLoadStoryCount=0;};u.prototype.fireTimer=function(){if(!this.initialStoriesLogged){this.initialStories.forEach(this.markStoryRead,this);this.initialStoriesLogged=true;}this.storiesInView=this.getStoriesInView();this.storiesInView.forEach(this.markStoryRead,this);if(this.trackingHooks){var x=this.isTimetrackingEnabled?this.getVisibleStoriesFromCache():this.getAllStoriesInView(),y=[],z=Object.keys(x);for(var aa=0,ba=z.length;aa<ba;aa++){var ca=z[aa];if(x[ca].story)y.push(x[ca].story);}c('ViewportTrackingHooks').updateVisibleViewportObjects(y);}};u.prototype.getSessionID=function(){return null;};u.prototype._userActivityPoller=function(){if(!this.userInactiveLock&&!c('UserActivity').isActive(this.timeToBeConsideredInactive)){this.userInactiveLock=true;this.userFocus=r;this.updateTimeTrackingData(false,'user_activity_inactive');c('UserActivity').subscribeOnce(function(){this.userFocus=q;this.updateTimeTrackingData(false,'user_activity_active');this.userInactiveLock=false;}.bind(this));}this.userActivityPollerTimeoutID=c('setTimeout')(this._userActivityPoller.bind(this),this.userActivityPollingInterval);};u.prototype.getQueryID=function(x){return -1;};u.prototype.getFBFeedLocations=function(x){return -1;};u.prototype.getFBFeedInsertionPosition=function(x){return -1;};u.prototype.createVPVDTimer=function(x){var y=document.createElement('label');y.setAttribute('for',x.toString());y.setAttribute('class','vpvd_debug_timer');return y;};u.prototype.updateVPVDTimer=function(x){var y=this.activeStories[x].story;if(!y)return;var z=c('DOM').scry(y,'.vpvd_debug_timer');if(!z.length){z=[this.createVPVDTimer(y),this.createVPVDTimer(y)];var aa=c('DOM').scry(y,'.UFIRow');if(aa.length&&aa[aa.length-1].clientWidth>0){aa[aa.length-1].appendChild(z[0]);}else y.appendChild(z[0]);y.insertBefore(z[1],y.firstChild);}var ba=this.totalVPVDuration[x],ca=Math.floor(ba/1000)+'.'+Math.floor(ba%1000/100);c('DOM').setContent(z[0],ca);c('DOM').setContent(z[1],ca);};u.prototype.updateVPVDTimers=function(){for(var x in this.activeStories)if(this.activeStories.hasOwnProperty(x))this.updateVPVDTimer(x);};u.prototype.logVpvdAnalysis=function(x,y,z,aa,ba,ca){var da=new (c('BanzaiScuba'))('vpv_duration');da.addDenorm('qid',this.getQueryID(this.activeStories[x].story));da.addDenorm('uid',c('CurrentUser').getID());da.addDenorm('vsid',x);da.addInteger('time',Math.round(Date.now()/1000));da.addInteger('duration',aa);da.addInteger('total_duration',ba);da.addNormal('story_state',this.activeStories[x].state);da.addNormal('is_active_state',z);da.addNormal('num_visible_stories',this.numVisibleStories);da.addInteger('story_height',this.activeStories[x].story_height);da.addInteger('story_visible_height',this.activeStories[x].height);da.addInteger('state_visible_height',ca);da.addInteger('total_visible_height',this.totalVisibleHeight);da.addInteger('total_height',this.totalHeight);da.addNormal('user_focus',this.latestUserFocus);da.addNormal('next_user_focus',this.userFocus);da.addInteger('vpvd',y);da.addInteger('accumulated_vpvd',this.activeStories[x].vpvd);da.addNormal('user_activity',this.latestUserActivity);da.addNormal('next_user_activity',this.userActivity);da.addInteger('story_position_y',this.activeStories[x].y);da.addInteger('feed_insertion_position',this.getFBFeedInsertionPosition(this.activeStories[x].story));da.addNormal('visible_position',this.activeStories[x].visible_position);da.addNormal('is_focused_story',this.activeStories[x].is_focused);da.post();};u.prototype.shouldDiscardStory=function(x){var y=this.activeStories[x].height||0;return y!=this.activeStories[x].story_height&&y<this.totalHeight/2;};u.prototype.calculateTotalHeight=function(){this.totalHeight=0;for(var x in this.activeStories)if(this.activeStories.hasOwnProperty(x))this.totalHeight+=this.activeStories[x].height;};u.prototype.updateVPVDurations=function(x){var y;if(this.latestUserFocus===r||x-this.latestTimeTrackingTimestamp>this.discardVPVDIntervalThreshold)return;var z=(y={},y[o]=0,y[n]=0,y[m]=0,y),aa=x-this.latestTimeTrackingTimestamp>=this.focused_state_duration;this.totalVisibleHeight=0;for(var ba in this.activeStories)if(this.activeStories.hasOwnProperty(ba))if(!(this.latestUserFocus===q&&aa&&this.shouldDiscardStory(ba))){var ca=this.activeStories[ba].state||null,da=this.activeStories[ba].height||0;if(ca!==null&&z.hasOwnProperty(ca))z[ca]+=da;this.totalVisibleHeight+=da;}var ea=0,fa=x-this.latestTimeTrackingTimestamp;if(this.latestUserFocus===q){fa=z[m]>0?this.focused_state_duration:this.active_state_duration;fa=Math.min(fa,x-this.latestTimeTrackingTimestamp);ea=x-this.latestTimeTrackingTimestamp-fa;}var ga=0,ha=m;for(var ia=m;ia>=o;ia--)if(z[ia]>0){ga=z[ia];ha=ia;break;}var ja=z[m]+z[n]+z[o],ka=0;for(ba in this.activeStories)if(this.activeStories.hasOwnProperty(ba)){if(this.latestUserFocus===q&&aa&&this.shouldDiscardStory(ba))continue;var la=this.activeStories[ba].state||p;if(ga>0&&la>=ha){var ma=this.activeStories[ba].height||0;ka=fa*(ma/ga);if(this.vpvdAnalysis&&fa>0)this.logVpvdAnalysis(ba,ka,true,fa,fa+ea,ga);this.activeStories[ba].vpvd+=ka;this.totalVPVDuration[ba]+=ka;}if(ja>0){var na=this.activeStories[ba].height||0;ka=ea*(na/ja);if(this.vpvdAnalysis&&ea>0)this.logVpvdAnalysis(ba,ka,false,ea,fa+ea,ja);this.activeStories[ba].vpvd+=ka;this.totalVPVDuration[ba]+=ka;}}};u.prototype.updateActiveStory=function(x,y,z,aa){this.activeStories[x].state=y;this.activeStories[x].ts=z;this.activeStories[x].height_snapshot=aa[x].height;this.activeStories[x].is_focused=this.focusedStory===aa[x].story;this.activeStories[x].story_height=aa[x].story_height;if(this.vpvdAnalysis){this.activeStories[x].visible_position=aa[x].visible_position;this.activeStories[x].y=aa[x].y;}};u.prototype.updateActiveStories=function(x,y){for(var z in x)if(x.hasOwnProperty(z))if(z in this.activeStories){var aa=x[z].height||0;this.activeStories[z].height=aa;var ba=aa-(this.activeStories[z].height_snapshot||0);if(this.focusedStory===x[z].story){this.updateActiveStory(z,m,y,x);}else if(ba<=-this.height_diff_to_change_state){this.updateActiveStory(z,this.shouldDiscardStory(z)?p:o,y,x);}else if(ba>=this.height_diff_to_change_state||this.activeStories[z].is_focused||this.activeStories[z].height===this.activeStories[z].story_height)this.updateActiveStory(z,n,y,x);}else{this.activeStories[z]={evp_ts:y,story:x[z].story,height:x[z].height,vpvd:0};if(!this.totalVPVDuration[z])this.totalVPVDuration[z]=0;this.updateActiveStory(z,n,y,x);}};u.prototype.recordVPVDurations=function(x,y){for(var z in this.activeStories)if(this.activeStories.hasOwnProperty(z))if(y||!(z in x)){var aa=this.activeStories[z].vpvd||0;if(aa>this.focused_state_duration||aa===this.totalVPVDuration[z])this.recordTimeStoryWasInView(this.activeStories[z]);delete this.activeStories[z];}};u.prototype.updateTimeTrackingData=function(x,y){this.userActivity=y;if(!this.activeStories)this.activeStories={};var z=Date.now();if(!this.latestTimeTrackingTimestamp)this.latestTimeTrackingTimestamp=z;var aa=this.getVisibleStoriesFromCache();this.calculateTotalHeight();this.updateVPVDurations(z);this.updateActiveStories(aa,z);if(this.vpvdDebug)this.updateVPVDTimers();this.recordVPVDurations(aa,x);if(x){this.latestTimeTrackingTimestamp=0;}else this.latestTimeTrackingTimestamp=z;this.latestUserActivity=this.userActivity;this.latestUserFocus=this.userFocus;if(this.focusedStory)this.latestActiveStory=this.focusedStory;this.latestFocusedStory=this.focusedStory;this.focusedStory=null;};u.prototype.needsToUpdateTimeTrackingData=function(){return !(this.latestUserFocus===this.userFocus&&(this.userFocus===r||this.userFocus===q&&!this.latestFocusedStory&&!this.focusedStory));};u.prototype.getfocusedStory=function(x){var y=this.getVisibleStoriesFromCache();for(var z in y)if(y.hasOwnProperty(z)){var aa=y[z].story;if(aa&&c('ViewportTrackingHelper').isDescendantOf(x,aa))return aa;}return null;};u.prototype.handleLayers=function(){if(this.userFocus===s||this.userFocus===t){this.focusedStory=this.latestActiveStory;this.updateTimeTrackingData(false,'media_layer');return true;}return false;};u.prototype.didInteractWithStream=function(x){if(!this.behavior.getStream)return false;var y=this.behavior.getStream();return c('ViewportTrackingHelper').isDescendantOf(x,y)||c('ViewportTrackingHelper').isDescendantOf(y,x);};u.prototype.handleScroll=function(event){if(this.handleLayers())return;var x=Date.now();!this.behavior.getStream?i(0):void 0;var y=c('getElementPosition')(this.behavior.getStream()).y;if(y!=this.lastStreamY||x-this.latestStreamYChangedTimeStamp<2.5*this.scrollThrottlingInterval||this.didInteractWithStream(event.target)){this.latestStreamYChangedTimeStamp=x;this.userFocus=q;}else this.userFocus=r;this.lastStreamY=y;if(this.userFocus===q||this.needsToUpdateTimeTrackingData())this.updateTimeTrackingData(false,'scroll');};u.prototype.handleKeyboard=function(event){if(this.handleLayers())return;if(this.didInteractWithStream(event.target)){this.userFocus=q;this.focusedStory=this.getfocusedStory(event.target);}else if(c('CSS').hasClass(event.target,'shareInput')){this.userFocus=q;this.focusedStory=this.latestActiveStory;}else this.userFocus=r;if(this.userFocus===q||this.needsToUpdateTimeTrackingData())this.updateTimeTrackingData(false,'keyboard');};u.prototype.handleMouse=function(event){if(this.handleLayers())return;if(event.type!='click'&&event.clientX===this.lastMouseX&&event.clientY===this.lastMouseY)return;if(event.type==='click')this.invalidateVisibleStoriesCache();if(this.didInteractWithStream(event.target)){this.userFocus=q;this.focusedStory=this.getfocusedStory(event.target);}else this.userFocus=r;this.lastMouseX=event.clientX;this.lastMouseY=event.clientY;if(this.needsToUpdateTimeTrackingData())this.updateTimeTrackingData(false,event.type);};u.prototype.getStoriesInView=function(){var x=this.behavior.getAllStories(),y=[],z=false;for(var aa=0;aa<x.length;aa++){var ba=x[aa],ca=this.behavior.getStoryID(ba);if(ca&&this.hasBeenVisible(ca))continue;if(c('ViewportTrackingHelper').isVisible(ba,this.minSizeToBeVisible,this.isLoose?this.maxScrollPosition:null)){if(ba.getAttribute('data-insertion-position')===null)ba.setAttribute('data-insertion-position',(aa-this._headLoadStoryCount).toString());y.push(ba);z=true;}else if(z)break;}return y;};u.prototype.getAllStoriesFromCache=function(){if(this.cachedAllStories.length===0)this.cachedAllStories=this.behavior.getAllStories();return this.cachedAllStories;};u.prototype.invalidateAllStoriesCache=function(){this.cachedAllStories=[];this.invalidateVisibleStoriesCache();};u.prototype.getVisibleStoriesFromCache=function(){if(!this.cachedVisibleStories.init)this.cachedVisibleStories={init:true,data:this.getAllStoriesInView()};return this.cachedVisibleStories.data;};u.prototype.invalidateVisibleStoriesCache=function(){this.cachedVisibleStories={init:false,data:{}};};u.prototype.getAllStoriesInView=function(){var x=this.getAllStoriesFromCache(),y={},z=false,aa=0,ba=x.length,ca=1,da=x.length;if(this._indexOfLastVisibleStoryOnPreviousPass>ba/2){aa=ba-1;ba=-1;ca=-ca;}for(var ea=aa;ea!=ba;ea+=ca){var fa=x[ea],ga=c('ViewportTrackingHelper').getHeightIfVisible(fa,Math.min(this.minSizeToBeVisible,this.minFractionToBeVisibleForTimetracking*c('DOMDimensions').getElementDimensions(fa).height));if(ga>0||fa===this.focusedStory){if(fa.getAttribute('data-insertion-position')===null)fa.setAttribute('data-insertion-position',(ea-this._headLoadStoryCount).toString());var ha=this.behavior.getStoryID(fa);if(ha){y[ha]={story:fa,height:ga,story_height:c('DOMDimensions').getElementDimensions(fa).height};z=true;if(this.vpvdAnalysis){y[ha].y=c('getElementPosition')(fa).y;y[ha].visible_position=ea;da=Math.min(da,ea);}}}else if(z){this._indexOfLastVisibleStoryOnPreviousPass=ea-ca;break;}}if(this.vpvdAnalysis){this.numVisibleStories=0;for(ha in y)if(y.hasOwnProperty(ha)){y[ha].visible_position-=da;this.numVisibleStories++;}}return y;};u.prototype.getTimetrackingDataToLog=function(x){var y={evt:j,vpvd_start_timestamp:x.evp_ts||null,vpvd_time_delta:Math.round(x.vpvd||0),story_height:c('DOMDimensions').getElementDimensions(x.story).height,viewport_height:this.cachedViewportHeight};return {ft:y};};u.prototype.recordTimeStoryWasInView=function(x){if(!this.isTimetrackingEnabled)return;if(!x.vpvd||!x.story)return;if(x.vpvd>0){var y=this.getTimetrackingDataToLog(x),z=c('collectDataAttributes')(x.story,['ft']);Object.assign(y.ft,z.ft);var aa=!!z.ft.ei&&y.ft.vpvd_time_delta>this.minTimeToReportImmediately;if(y.ei)delete y.ei;!x.story?i(0):void 0;this.sendDataToLog(x.story,y,aa);}};u.prototype.hasBeenVisible=function(x){return x in this.readStoryIDs;};u.prototype.sendDataToLog=function(x,y,z){if(this.useBanzai){var aa={};if(z)aa.delay=3000;var ba=this.getSessionID();if(ba)y.ft.session_id=ba;c('Banzai').post('feed_tracking',y,aa);}else c('clickRefAction')(l,x,null,'FORCE',y);};u.prototype.markStoryRead=function(x){var y=this.behavior.getStoryID(x);if(!y||this.hasBeenVisible(y))return;this.readStoryIDs[y]=true;this.annotatedStoryIDs[y]=true;var z=this._getDataToLogImpl(x),aa=c('collectDataAttributes')(x,['ft']);Object.assign(z.ft,aa.ft);delete z.ei;this.sendDataToLog(x,z,false);c('CSS').addClass(x,"_x72");if(this.vpvDebug)c('CSS').addClass(x,"_5m7s");};u.prototype.logAnnotatedVPV=function(x){var y=this.behavior.getStoryID(x);if(!y||y in this.annotatedStoryIDs)return;this.annotatedStoryIDs[y]=true;var z=this._getDataToLogImpl(x),aa=c('collectDataAttributes')(x,['ft']);Object.assign(z.ft,aa.ft);delete z.ei;z.ft.vpv_ft_only=1;this.sendDataToLog(x,z,false);};u.prototype._getDataToLogImpl=function(x){var y=this.behavior.getDataToLog(x);if(!y.ft)y.ft={};return y;};u.clearSingleton=function(){};var v={getAllStories:function x(){return [];},getStoryID:function x(y){return null;},getDataToLog:function x(y){return {};}},w=c('viewportTrackingBuilder')(function(x){return new u(v);});u.factory=w.factory.bind(w);u.singleton=w.singleton.bind(w);u.clearSingleton=w.clearSingleton.bind(w);u.getBehavior=function(){return v;};f.exports=u;}),null);
__d('collectSubtreeData',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(j,k,l,m,n){if(j.offsetWidth===0&&j.offsetHeight===0)return n;var o={};if(j.getAttribute)for(s=0;s<k.length;s++){u=k[s];var p=j.getAttribute(l[u]);if(p){o[u]={};var q=JSON.parse(p);for(var r in m)if(q[r]!==undefined){o[u][r]=true;if(n[u]===undefined)n[u]={};if(n[u][r]===undefined)n[u][r]=[];if(m[r].length>0)n[u][r].push(m[r]);n[u][r].push('('+q[r]);}}}for(var s=0;s<j.childNodes.length;s++){var t=j.childNodes[s];h(t,k,l,m,n);}for(var u in o)for(var v in o[u]){var w=n[u][v][n[u][v].length-1];if(w.length>0&&w.charAt(0)=='('){n[u][v][n[u][v].length-1]=w.substr(1);}else n[u][v].push(')');}return n;}function i(j,k){var l={};for(var m=0;m<k.length;++m)l[k[m]]='data-'+k[m];var n={tn:"","tn-debug":","},o={};h(j,k,l,n,o);for(var p in o)for(var q in o[p])o[p][q]=o[p][q].join('');return o;}f.exports=i;}),null);
__d('recordTNTreeData',['collectSubtreeData'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){var k={},l=c('collectSubtreeData')(i,['ft']);for(var m in l.ft){k[m+'_tree']=l.ft[m];if(m==='tn-debug')i.setAttribute('tn-debug_subtree',l.ft[m]);}k.evt_value=i.offsetHeight;if(j)k.offset=Math.max(0,i.offsetTop-j.offsetTop);return k;}f.exports=h;}),null);
__d('StreamViewportTracking',['DataAttributeUtils','DOM','DOMDimensions','ViewportTracking','ge','recordTNTreeData','viewportTrackingBuilder'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=51;function k(n,o,p){return {_stream:null,getDataFromConfig:function q(r,s){s.isTimetrackingEnabled=true;},getAllStories:function q(){var r=c('DOM').scry(this.getStream(),p);return r.filter(function(s){return c('DataAttributeUtils').getDataFt(s);});},getStream:function q(){if(o)return o;if(!this._stream)this._stream=c('ge')('home_stream');return this._stream;},getStoryID:function q(r){var s=JSON.parse(c('DataAttributeUtils').getDataFt(r));return s&&s.mf_story_key;},getDataToLog:function q(r){var s=this.getStream(),t=c('recordTNTreeData')(r,s),u=r.getAttribute('data-insertion-position');if(u!==null)t.inspos=u;t.evt=j;t.vpv_time=Math.round(Date.now()/1000);var v=c('DOM').scry(r,'.fbStoryAttachmentImage')[0];if(v){var w=c('DOMDimensions').getElementDimensions(v);t.story_image_height=w.height;t.story_image_width=w.width;}return {ft:t};}};}h=babelHelpers.inherits(l,c('ViewportTracking'));i=h&&h.prototype;l.prototype.getQueryID=function(n){var o=JSON.parse(c('DataAttributeUtils').getDataFt(n));return o.qid;};l.prototype.getFBFeedLocations=function(n){var o=JSON.parse(c('DataAttributeUtils').getDataFt(n));return o.fbfeed_location;};l.prototype.getFBFeedInsertionPosition=function(n){var o=JSON.parse(c('DataAttributeUtils').getDataFt(n));return o.insertion_position;};l.prototype.cleanup=function(){m.clearSingleton();i.cleanup.call(this);};function l(){h.apply(this,arguments);}var m=c('viewportTrackingBuilder')(function(n,o){var p=new l(k(n,o,'.uiStreamStory'));p.init(n);return p;});l.factory=m.factory.bind(m);l.singleton=m.singleton.bind(m);l.clearSingleton=m.clearSingleton.bind(m);l.getBehavior=k;f.exports=l;}),null);
__d('VideoFrameBuffer',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){'use strict';this.$VideoFrameBuffer2=j;this.$VideoFrameBuffer1=i;this.$VideoFrameBuffer3=k||'contain';}h.prototype.updateFrameBuffer=function(){'use strict';if(this.$VideoFrameBuffer4){this.$VideoFrameBuffer1.width=this.$VideoFrameBuffer4;this.$VideoFrameBuffer4=null;}if(this.$VideoFrameBuffer5){this.$VideoFrameBuffer1.height=this.$VideoFrameBuffer5;this.$VideoFrameBuffer5=null;}var i=this.$VideoFrameBuffer1.clientWidth||this.$VideoFrameBuffer1.width,j=this.$VideoFrameBuffer1.clientHeight||this.$VideoFrameBuffer1.height,k=i,l=j,m=this.$VideoFrameBuffer2.videoWidth/this.$VideoFrameBuffer2.videoHeight,n=k/l;if(this.$VideoFrameBuffer3==='cover'){n*=-1;m*=-1;}if(n>m){k=l*m;}else if(n<m)l=k/m;var o=this.$VideoFrameBuffer1.getContext('2d');if(!(o instanceof window.CanvasRenderingContext2D))return;o.drawImage(this.$VideoFrameBuffer2,(i-k)/2,(j-l)/2,k,l);};h.prototype.getDOMNode=function(){'use strict';return this.$VideoFrameBuffer1;};h.prototype.updateDimensions=function(i,j){'use strict';this.$VideoFrameBuffer4=i;this.$VideoFrameBuffer5=j;};f.exports=h;}),null);